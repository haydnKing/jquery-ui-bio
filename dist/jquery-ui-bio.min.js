/*! jQuery Ui Bio - v0.1.0 - 2013-02-05
* https://github.com/Gibthon/jquery-ui-bio
* Copyright (c) 2013 Haydn King; Licensed MIT, GPL */
this.bio=this.bio||{},function(e){var t=e("script").last().attr("src").replace(/\w+\.js$/,"jquery-ui-bio-worker.js"),n=function(e,t,n){this.init(e,t,n)},r=n.prototype;r.init=function(e,t,n){this.start=e||0,this.end=t||0,this.strand=(n||1)>0?1:-1;if(this.end<this.start){var r=this.end;this.end=this.start,this.start=r}},r.overlaps=function(e){Array.isArray(e)||(e=[e]);for(var t=0;t<e.length;t++)if(this.contains(e[t].start)||this.contains(e[t].end)||e[t].start<=this.start&&e[t].end>this.start)return!0;return!1},r.contains=function(e){return this.start<=e&&this.end>e},r.length=function(){return this.end-this.start},bio.FeatureLocation=n;var i=function(e,t,n,r){this.init(e,t,n,r)},s=i.prototype;s.location=null,s.type="NoneType",s.id=-1,s.qualifiers={},s.strand=function(){return this.location.strand},s.length=function(){return this.location.length()},s.overlaps=function(e){Array.isArray(e)||(e=[e]);for(var t=0;t<e.length;t++)if(this.location.overlaps(e[t].location))return!0;return!1},s.inRange=function(e){return this.location.overlaps(e)},s.toString=function(){return"[seqFeature (id="+this.id+", type="+this.type+"]"},s.init=function(e,t,n,r){n==null&&(n=-1),this.location=e,this.type=t||"NoneType",this.id=n,this.qualifiers=r||{}},bio.SeqFeature=i,bio.loadFeatureLocation=function(e){Array.isArray(e)||(e=[e]);var t=[];for(var r=0;r<e.length;r++)t.push(new n(e[r].start,e[r].end,e[r].strand));return t},bio.loadSeqFeature=function(e){Array.isArray(e)||(e=[e]);var t=[];for(var n=0;n<e.length;n++)t.push(new i(bio.loadFeatureLocation(e[n].location)[0],e[n].type,e[n].id,e[n].qualifiers));return t};var o=function(e,t,n,r){this.init(e,t,n,r)},u=o.prototype;u.features=[],u.tile_size=1024,u.seq_length=0,u.types=[],u.by_type={},u.stacks={},u.tiles=[],u.getTypes=function(){return this.types},u.getStackHeight=function(){return this.stacks},u.getFeatures=function(){return this.features},u.getFeaturesByType=function(e){return this.by_type[e.toLowerCase()]},u.getFeaturesByTile=function(e,t){if(!t)return this.tiles[e];var n=this.tiles[e],r;for(r=e;r<=t;r+=1)a(this.tiles[r],n);return n},u.pos2tile=function(e){return Math.floor(e/this.tile_size)},u.tile2pos=function(e){return[this.tile_size*e,this.tile_size*(e+1)]};var a=function(t,n,r){var i,s;for(i in t)for(s=0;s<t[i].length;s+=1){if(r!=null&&!t[i][s].inRange(r))continue;e.inArray(t[i][s],n[i])<0&&n[i].push(t[i][s])}};u.getFeaturesInRange=function(e,t){var n,r,i,s;e>t&&(i=t,t=e,e=i),n=this.pos2tile(e),r=this.pos2tile(t);var o={};for(s in this.types)o[this.types[s]]=[];var u={start:e,end:t};a(this.tiles[n],o,u);for(s=n+1;s<=r-1;s+=1)i=this.tiles[s],a(this.tiles[s],o);return n!==r&&a(this.tiles[r],o,u),o},u.init=function(e,t,n,r){this.features=e||[],r==null&&typeof n=="boolean"&&(r=n,n=null),n!=null&&(this.tile_size=parseInt(n,10)),this.seq_length=t;if(this.seq_length==null)throw"Error: sequence length must be specified";r==null&&(r=!0),this.done=0,this.total=this.features.length,this.stacks={fwd:{},rev:{}},r&&this.go()},u.go=function(){this._calc_types(),this._alloc_tiles(),this._process()},u._calc_types=function(){var e,t,n;this.by_type={},this.types=[];for(e=0;e<this.features.length;e++)t=this.features[e],n=t.type.toLowerCase(),this.by_type.hasOwnProperty(n)||(this.by_type[n]=[],this.types.push(n)),this.by_type[n].push(t)},u._process=function(){var t=this,n=function(r){t._process_type(t.types[r]),e(t).trigger("progress",{done:t.done,total:t.total}),r+1<t.types.length?setTimeout(function(){n(r+1)},50):e(t).trigger("completed")};n(0)},u._process_type=function(e){var t=this.getFeaturesByType(e),n=[],r=[];for(var i=0;i<t.length;i++)t[i].strand()>=0?n.push(t[i]):r.push(t[i]);this.stacks.fwd[e]=this._set_tracks(n),this._calc_tiles(n),this.stacks.rev[e]=this._set_tracks(r),this._calc_tiles(r)},u._set_tracks=function(e){if(e.length===0)return 0;var t=0,n,r,i=[[]],s;e.sort(function(e,t){return t.length()-e.length()});for(n=0;n<e.length;n++){r=e[n],s=!1;for(t=0;t<i.length;t++)if(!r.overlaps(i[t])){s=!0;break}s?(i[t].push(r),r.track=t):(r.track=i.length,i.push([r]))}return i.length},u._alloc_tiles=function(){var e,t,n;this.tiles=[];for(e=0;e<this.seq_length/this.tile_size;e++){n={};for(t=0;t<this.types.length;t++)n[this.types[t]]=[];this.tiles.push(n)}},u._calc_tiles=function(e){var t,n,r,i,s,o;e=e||this.features;for(n=0;n<e.length;n++){t=e[n],s=this.pos2tile(t.location.start),o=this.pos2tile(t.location.end-1);for(i=s;i<=o;i++)this.tiles[i][t.type.toLowerCase()].push(t)}this.done+=e.length},bio.FeatureStore=o;var f=function(e,t){this.tile_size=t||this.tile_size,this.cb=e,this.seq={}},l=f.prototype;l.tile_size=1024,l.get=function(t,n,r){var i=this,s=0,o=[],u=Math.floor(t/this.tile_size),a=Math.floor(n/this.tile_size),f,l=function(t){return function(n){s-=1,i._add_tile(t,n),s===0&&e.isFunction(r)&&r()}};for(f=u;f<=a;f+=1)this.seq[f]?o.push({from:this.tile_size*f,to:this.tile_size*(f+1),seq:this.seq[f]}):(s+=1,this.cb(l(f),f*this.tile_size,(f+1)*this.tile_size));return o.length>0&&(o[o.length-1].seq=o[o.length-1].seq.slice(0,Math.min(this.tile_size,n-a*this.tile_size)),o[o.length-1].end=n,o[0].seq=o[0].seq.slice(Math.max(0,t-u*this.tile_size)),o[0].from=t),o},l._add_tile=function(e,t){this.seq[e]=t.toLowerCase()},bio.SequenceCache=f}(jQuery),this.bio=this.bio||{},function(e,t){this.bio.read_data=function(t,n,r,i,s){var o;if(!e.isFunction(t))throw"Error: cb must be a function";if(n==null)throw"Error: target must be provided";r==null?(s="",i=null,r={}):r instanceof e&&(s=i||"",i=r,r={}),s=s||"",r=r||{},s!==""&&(s+=".");var u=function(e,t){i!=null&&i.trigger(s+e,t)};typeof n=="string"?o=e.ajax(n,{data:r,success:t,error:function(e,t,n){u("error",{status:t,message:n})}}):e.isFunction(n)&&(o=n(t,r),o.onerror=function(e){u("error",{status:"error",message:o.statusText})}),e(o).on("progress",function(e){var t=e.originalEvent;e.lengthComputable=t.lengthComputable,e.loaded=t.loaded,e.total=t.total,e.lengthComputable&&u("progress",e)})}}(jQuery),function(e,t){var n="tooltip ui-widget ui-widget-content ui-corner-all",r="tooltip-left",i="tooltip-right",s="tooltip-top",o="tooltip-bottom",u="ui-widget-content",a="stringContent",f="tip",l=150,c="black";e.widget("bio.tooltip",{options:{hover:250,click:!1,holdOpen:!0,autoClose:!0,content:null,title:null,extraClasses:null,width:100,color:"default",location:"center",direction:"auto",fadeIn:0,fadeOut:100},_create:function(){var t=this.el=e(this.element[0]),n=this.options,r=this;this._tooltip=null,this._evt=null,this._visible=!1,this._enabled=!0,this._timeout=null,this._hidefn=function(){r.hide()}},_init:function(){this._bind_events()},show:function(){if(!this._enabled||this._trigger("beforeShow")===!1)return;this._visible&&this.hide(),this._create_tip();if(!this._set_content()){this._tooltip.remove(),this._tooltip=null;return}this._set_size(),this._set_location(),this._set_color();var t=this;this._tooltip.fadeTo(this.options.fadeIn,1,function(){t._trigger("show")}),this._visible=!0,e(document).one("click",function(){e(document).on("click",t._hidefn)})},hide:function(){e(document).off("click",this._hidefn);if(!this._visible||this._trigger("beforeHide")===!1)return;var t=this,n=t._tooltip;this._tooltip.fadeOut(this.options.fadeOut,function(){n.remove(),t._trigger("hide")}),this._visible=!1,t._tooltip=null},enable:function(){this._enabled=!0},disable:function(){this._enabled=!1,this.hide()},updateContent:function(e){this._set_content(e,!0)},_bind_events:function(){var e=this;this.el.mousemove(function(t){e._mousemove(t)}).mouseleave(function(t){e._mouseleave(t)}).mouseenter(function(t){e._mouseenter(t)}).click(function(t){e._mouseclick(t)})},_mousemove:function(e){if(!this._enabled)return;this._evt=e;var t=this;!this._visible&&this.options.hover>0&&(this._clear_timeout(),this._set_timeout(this.options.hover,function(){t.show()}))},_mouseleave:function(e){if(!this._enabled)return;this._evt=e;var t=this;this.options.autoClose&&this._set_timeout(l,function(){t.hide()})},_mouseenter:function(e){if(!this._enabled)return;this._evt=e,this._clear_timeout()},_mouseclick:function(e){if(!this._enabled)return;this._evt=e,this.options.click&&this.show()},_clear_timeout:function(){typeof this._timeout=="number"&&(clearTimeout(this._timeout),this._timeout=null)},_set_timeout:function(e,t){this._clear_timeout(),this._timeout=setTimeout(function(){this._timout=null,t()},e)},_create_tip:function(){var t=this;this._tooltip=e("<div>").addClass(n+" "+(this.options.extraClasses||"")).fadeTo(0,0).mouseenter(function(e){t._mouseenter(e)}).mouseleave(function(e){t._mouseleave(e)}).click(function(e){e.stopPropagation()}).append(e("<div>").addClass(u)).appendTo(e("body"))},_set_content:function(t,n){t=t||this.options.content,n=n||!1;var r,i,s=this;e.isFunction(t)&&(t=t(this._evt));if(t===!1)return!1;if(this.el.attr(f)!=null)t=this._get_title().add(e("<p>").text(this.el.attr(f)).addClass(a));else if(typeof t=="string")t=this._get_title().add(e("<p>").text(t).addClass(a));else if(Array.isArray(t)){r=e();for(i=0;i<t.length;i++)r=r.add(this._make_item(t[i],i));t=this._get_title().add(e("<div>").append(r))}else{if(!(t instanceof e))throw"No content specified";t=this._get_title().add(t)}return n?(this._tooltip.height(this._tooltip.height()),this._tooltip.children("div").empty().append(t),this._tooltip.animate({height:this._tooltip.children("div").height()},"fast",function(){s._tooltip.css("height",""),s._set_size(),s._set_location()})):this._tooltip.children("div").empty().append(t),!0},_get_title:function(){var t=this.options.title;e.isFunction(t)&&(t=t(this._evt));if(t==null||t==="")return e();if(typeof t=="string")return e("<div>").addClass("tooltip-title").append(e("<span>").text(t));throw"Unknown title type"},_set_size:function(){var e=this.options.width,t;if(typeof e=="string"&&/%$/.test(e)){var n=parseFloat(e.match("([0-9.]+)%")[1]);e=this.el.width()*n/100}this._tooltip.width(e)},_set_location:function(){var t=this.options.location,n=this.options.direction,u,a,f,l,c;if(t==="center")u=this.el.offset(),u.left+=this.el.width()/2,u.top+=this.el.height()/2;else{if(t!=="mouse")throw"Invalid location '"+t+"'";u={top:this._evt.pageY,left:this._evt.pageX}}n==="auto"&&(a={width:e(window).width(),height:e(window).height()},f={top:e(document).scrollTop(),left:e(document).scrollLeft()},l={width:this._tooltip.outerWidth(!0),height:this._tooltip.outerHeight(!0)},c={top:u.top-f.top,left:u.left-f.left,bottom:f.top+a.height-u.top,right:f.left+a.width-u.left},c.bottom>=l.height&&c.left>=l.width/2&&c.right>=l.width/2?n="s":c.top>=l.height&&c.left>=l.width/2&&c.right>=l.width/2?n="n":c.right>=l.width&&c.top>=l.height/2&&c.bottom>=l.height/2?n="e":c.left>=l.width&&c.top>=l.height/2&&c.bottom>=l.height/2?n="w":c.right>=c.left?n="e":n="w"),e.isFunction(n)&&(n=n(this._evt));var h=this._tooltip;if(n==="n")h.addClass(s),u.left-=l.width/2,u.top-=l.height;else if(n==="s")h.addClass(o),u.left-=l.width/2;else if(n==="e")h.addClass(i),u.top-=l.height/2;else{if(n!=="w")throw"Unknown direction '"+n+"'";h.addClass(r),u.left-=l.width,u.top-=l.height/2}h.css(u)},_set_color:function(){var t=this.options.color;e.isFunction(t)&&(t=t(this._evt));if(t==="default"){if(this.el.css("border-color").length>0)return;t=c}else t==="parent"&&(t=this.el.css("border-color"));this._tooltip.css("border-color",t)},_make_item:function(t,n){var r=this,i=e("<span>");t.icon!=null&&t.icon!==""?i.addClass("ui-icon "+t.iconClass||""):i.css(t.iconCSS||{}).addClass("ui-corner-all");var s=e("<div>").addClass("tooltip-item ui-widget-content ui-state-default").append(e("<div>").addClass("tooltip-icon").append(i)).append(e("<div>").addClass("tooltip-desc").append(e("<span>").text(t.title)).append(e("<p>").text(t.sub||""))).mouseenter(function(e){s.addClass("ui-state-hover")}).mouseleave(function(e){s.removeClass("ui-state-hover")}).mousedown(function(e){s.addClass("ui-state-active")}).mouseup(function(e){s.removeClass("ui-state-active")}).click(function(e){r._trigger("selected",e,{index:n,tooltip:r.el,item:s,data:t})});return s}})}(jQuery),function(e,t){var n="bio-help ui-widget",r="bio-help-tip",i="ui-corner-all";e.widget("bio.help",{options:{helphtml:"Some Help",open:t,close:t,width:null},_init:function(){var t=this,i=this.options,s=this.el=e(this.element[0]).addClass(n),o=e("<div>").addClass(r);s.hasClass("ui-corner-all")&&o.addClass("ui-corner-all"),this.help=e("<p>").html(i.helphtml).appendTo(o),this.el.tooltip({content:o,width:this.options.width||250})},_create:function(){},setHelp:function(e){this.options.helphtml(e),this.help.html(e)}})}(jQuery),function(e,t){var n="bio-statusbar ui-widget-content ui-state-default",r="ui-icon",i=/%\(([\w]+)\)/g,s="default";e.widget("bio.statusBar",{options:{message:null,state:null,text:{defaultMessage:"Ready"},defaultState:"default",states:{"default":{icon:"ui-icon-circle-triangle-e",state:""},info:{icon:"ui-icon-info",state:""},warning:{icon:"ui-icon-alert",state:"ui-state-highlight"},error:{icon:"ui-icon-alert",state:"ui-state-error"},loading:{icon:"ui-icon-refresh",state:"ui-state-highlight"},ok:{icon:"ui-icon-circle-check",state:""},add:{icon:"ui-icon-circle-plus",state:"ui-state-highlight"},remove:{icon:"ui-icon-circle-minus",state:"ui-state-highlight"},saved:{icon:"ui-icon-disk",state:"ui-state-highlight"}}},_create:function(){var t=this,i=this.options;this.el=e(this.element[0]).addClass(n),this.icon=e("<span>").addClass(r).appendTo(this.el),this.text=e("<p>").appendTo(this.el),this.set(i.message||i.text.defaultMessage)},set:function(e,t,i){e=e||this.options.text.defaultMessage;if(typeof t=="string"||i==null)i=t,t=null;i=i||this.options.defaultState,t!=null&&(e=this._format(e,t)),i=this.options.states[i];if(typeof i=="undefined")throw"Error: unknown state '"+i+"'";this.text.text(e),this.icon.attr("class",r+" "+i.icon),this.el.attr("class",n+" "+i.state)},_format:function(e,t){return e.replace(i,function(n,r,i){return i>0&&e.charAt(i-1)==="\\"?"%("+r+")":String(t[r])})}})}(jQuery),function(e,t){var n="ui-widget bio-panel",r="ui-widget-header ui-state-default",i="bio-panel-content ui-widget-content",s="bio-panel-item ui-widget-content",o="bio-footer ui-widget-header ui-state-default",u="ui-icon-circle-triangle-e";e.widget("bio.panel",{options:{title:t,help:t,text:{defaultTitle:"Bio Panel",defaultHelp:"",defaultStatus:"Ready"},height:400,showStatus:!0},_create:function(){var t=this,s=this.options,u=this.el=e(this.element[0]).addClass(n);s.title=s.title||s.text.defaultTitle,s.help=s.help||s.text.defaultHelp,s.color=s.color||next_color();var a=this.head=e("<div>").addClass(r).appendTo(u),f=this.panel=e("<div>").addClass(i).appendTo(u),l=this.status=e("<div>").statusBar().appendTo(u),c=this.foot=e("<div>").addClass(o).appendTo(u);this.stretch_factors={panel:1},this.title=e("<span>").addClass("title").text(s.title).appendTo(a);var h=this.help=e("<span>").appendTo(a).help({helphtml:s.help});s.showStatus||l.hide(),u.hasClass("ui-corner-all")&&(a.addClass("ui-corner-top"),c.addClass("ui-corner-bottom"),h.addClass("ui-corner-all"))},_init:function(){this._set_height()},option:function(e,t){if(t==null)return this.options[e];switch(e){case"title":this.head.find("span").text(t);break;case"help":this.help("setHelp",t);break;case"height":this._set_height(t)}this.options[e]=t},setStatus:function(e,t,n){this.status.statusBar("set",e,t,n)},_refresh:function(){this._set_height()},_set_height:function(e){var t=0,n=0;e=e||this.options.height;for(var r in this.stretch_factors)n+=this.stretch_factors[r],t+=this[r].outerHeight();var i=this.el.outerHeight()-t;t=Math.max(0,e-i);for(r in this.stretch_factors)this[r].outerHeight(t*this.stretch_factors[r]/n)},_panel_item:function(t){return(t||e("<div>")).addClass(s)}})}(jQuery);var next_color=function(){var e=Math.random()*360,t=360/1.61803;return function(){return e=Math.floor(e+t)%360,"hsl("+e+",40%,50%)"}}();(function(e,t){var n="bio-search ui-widget",r="ui-state-default",i="ui-state-hover",s="ui-state-focus",o="ui-state-error";e.widget("bio.search",{options:{text:{search:"search"},items:e(),filterFunc:function(e,t){return!0},beforeFilter:t,filter:t,pause:150,anim:0},_create:function(){var t=this,i=this.options,s=this.el=e(this.element[0]).addClass(n);this.timeout=null,s.addClass(n).addClass(r),this.input=e('<input type="text">').appendTo(e("<div>").appendTo(s)),this.search_hint=e("<div>").addClass("hint").text(i.text.search).appendTo(s),e("<span>").addClass("ui-icon ui-icon-search").appendTo(s),this.search_clear=e("<span>").addClass("ui-icon ui-icon-close").hide().appendTo(s)},_init:function(){var t=this,n=this.options;this.input.on({focus:function(){t.search_hint.hide(),t.el.addClass(s)},blur:function(){e(this).val()||(t.search_hint.show(),t.search_clear.hide()),t.el.removeClass(s)},keyup:function(){var e=t.input.val();e?t.search_clear.show():t.search_clear.hide(),t.timeout&&clearTimeout(t.timeout),t.timeout=setTimeout(function(){t.timeout=null,t._filter()},n.pause)}}),this.el.on({click:function(){t.input.focus()},mouseenter:function(){t.el.addClass(i)},mouseleave:function(){t.el.removeClass(i)}}),this.search_clear.on("click",function(){t.input.val(""),t.search_clear.hide(),t._filter()})},value:function(e){if(e!=null){this.input.val(e),this._filter();return}return this.input.val()},_filter:function(){if(this._trigger("beforeFilter")!==!0)return;var t=this.options.filterFunc,n=new RegExp(this.input.val(),"i"),r=this.options.items,i=e(),s=e();if(!e.isFunction(t))throw"search.options.filterFunc is not callable";e.isFunction(r)&&(r=r()),r.each(function(){t(n,e(this))?i=i.add(e(this)):s=s.add(e(this))}),i.filter(":hidden").slideDown(this.options.anim),s.filter(":visible").slideUp(this.options.anim),i.length===0&&s.length>0?this.el.addClass(o):this.el.removeClass(o),this._trigger("filter",null,{search:this.el,hide:s,show:i})}})})(jQuery),function(e,t){var n="bio-fragment ui-widget",r="ui-state-hover ui-state-active",i="ui-state-disabled",s="bio-fragment-info",o=10,u=function(e,t,n){n==null&&(n=!0);var r=t/2,i=e-r,s=n?r:-r,o=n?0:r,u="M"+o+",0 h"+i+" l"+r+","+r+" l"+ -r+","+r+" h"+ -i+" l"+r+","+ -r+" z";return u};e.widget("bio.fragment",{options:{name:null,desc:null,length:null,url:t,color:t,width:t,text:{goto_page:"Goto Page",def_desc:"No Description",def_name:"Unnamed Fragment"},helper:"clone"},_create:function(){var t=this.options,r=this,i=this.el=e(this.element[0]).addClass(n);t.name=i.attr("name")||t.name||t.text.def_name,t.desc=i.attr("desc")||t.desc||t.text.def_desc,t.length=i.attr("length")||t.length||0,t.url=i.attr("href")||t.url,t.color=t.color||next_color(),t.width=t.width||i.width(),i.width(t.width);var o=i.width(),u=i.height();this.paper=Raphael(this.element[0],o,u),this.frag=this.paper.path(""),this.name=this.paper.text(o/2,u/2,this.options.name).attr({fill:"white",font:"inherit"}),this.info=e("<div>").addClass(s).mousedown(function(e){e.stopPropagation()}),this.refreshInfo(),i.css({"border-color":t.color}),t.helper==="clone"&&(t.revert=!0,t.helper=function(){return e("<div>").addClass(n).css("z-index",200).append(i.children("svg").clone())}),this.el.tooltip({color:function(){return t.color},content:this.info,width:"125%"}),this._redraw_frag(),this._set_color()},_init:function(){},option:function(e,t){var n=this.options;if(t==null)return n[e];n[e]=t;switch(e){case"name":this._redraw_frag();break;case"desc":case"length":case"url":this.refreshInfo();break;case"width":this._redraw_frag();break;case"color":this.el.css({"border-color":this.options.color}),this._anim_color()}return this},refreshInfo:function(){var t=this.options;this.info.html(""),e('<div><p class="bio-length">'+t.length+"</p></div>").appendTo(this.info),e('<div><p class="bio-desc">'+t.desc+"</p></div>").appendTo(this.info),t.url!=null&&e("<div><a href="+t.url+' class="bio-url">'+t.text.goto_page+"</a></div>").appendTo(this.info)},disable:function(){this.el.tooltip("disable")},enable:function(){this.el.tooltip("enable")},ghost:function(e){e==null&&(e=!0),e?(this.name.attr("opacity",0),this.frag.attr({fill:null,stroke:"#555555","stroke-dasharray":"-"})):(this.name.attr("opacity",1),this._set_color(),this.frag.attr("stroke-dasharray",""))},_set_color:function(){var e=this.options.color.match(/\d+/g);this.frag.attr({fill:Raphael.hsl(e[0],e[1],e[2]),stroke:Raphael.hsl(e[0],e[1],Math.max(0,e[2]-10))})},_anim_color:function(){var e=this.options.color.match(/\d+/g),t=Raphael.animation({fill:Raphael.hsl(e[0],e[1],e[2]),stroke:Raphael.hsl(e[0],e[1],Math.max(0,e[2]-10))},1e3);this.frag.animate(t.delay(100))},_redraw_frag:function(){var e=this.el.width(),t=this.el.height();this.paper.setSize(e,t),this.frag.attr({path:u(e,t)}),this.name.attr({x:e/2,y:t/2,text:this.options.name});var n=this.options.name.length-1;while(this.name.getBBox().width+t>e)n-=1,this.name.attr({text:this.options.name.substr(0,n)+"..."})}})}(jQuery),function(e,t){var n="bio-fragment-select ui-widget",r="ui-icon-circle-triangle-e",i=function(e,t){return t=t.children(":bio-fragment"),e.test(t.fragment("option","name"))||e.test(t.fragment("option","desc"))};e.widget("bio.fragmentSelect",e.bio.panel,{options:{title:t,help:t,text:{defaultTitle:"Fragment Selector",defaultHelp:"Drag and drop fragments to select them",filter:"filter",loading:"Loading fragments...",loaded:"Loaded %(total) %(fragment)",error:"Error",none_loaded:"No fragments are loaded",none_matching:"No fragments match the filter",showing_all:"Showing %(total) %(fragment)",showing_filter:"Showing %(filter) of %(total) %(fragment)",add_fragment:"Added fragment '%(name)'",remove_fragment:"Removed fragment '%(name)'",fragment:"fragment",fragments:"fragments",cberror:"An error occurred"},defaultHelper:"clone",height:400,src:t,color:null},_create:function(){this._super();var t=this,r=this.options,s=this.el=e(this.element[0]).addClass(n);this.stretch_factors={ul:1},this.timeout=null;var o=t._panel_item().addClass("searchbar").appendTo(this.panel);this.search=e("<div>").search({text:{search:"filter"},filter:function(e,n){t.filterStatus(n.show.length,n.hide.length)},filterFunc:i,items:function(){return t.list.find(":bio-fragment").parent()},anim:200}).appendTo(o),this.list=this._panel_item().addClass("list").appendTo(this.panel);var u=this.ul=s.find("ul");u.length===1?u.detach().appendTo(this.list):u=this.ul=e("<ul>").appendTo(this.list),u.sortable({placeholder:"ui-widget-content bio-fragment-placeholder",connectWith:".bio-panel ul",start:function(e,t){t.item.find(":bio-fragment").fragment("disable")},stop:function(e,t){t.item.find(":bio-fragment").fragment("enable")},receive:function(e,n){var i=n.item.find(":bio-fragment");i.fragment("option","color",r.color),t.setStatus(r.text.add_fragment,{name:i.fragment("option","name")},"add")},remove:function(e,n){var i=n.item.find(":bio-fragment");t.setStatus(r.text.remove_fragment,{name:i.fragment("option","name")},"remove")},helper:function(t,n){return e(n).find(":bio-fragment").clone().appendTo(e("body"))}});var a=function(n){for(var i=0;i<n.length;i++){var s=n[i];e("<li>").append(e("<div>").attr({name:s.name,length:s.length,desc:s.desc,href:s.url})).appendTo(u)}u.find("li").each(function(){var t=e(this).width();e(this).children().fragment({color:r.color,width:t})}),t.setStatus(r.text.loaded,{total:n.length,fragment:n.length===1?r.text.fragment:r.text.fragments},"ok"),u.animate({"margin-top":0},"fast",function(){t.list.css("overflow",""),u.css("margin-top","")})};if(r.src!=null)if(typeof r.src=="string")this.list.css("overflow","hidden"),u.css("margin-top",this.list.height()+"px"),this.setStatus(r.text.loading,"loading"),e.ajax({url:r.src,dataType:"json",success:a,error:function(e,n,r){t.setStatus(String(r),"error")}});else{if(!e.isFunction(r.src))throw"options.src must be a string URL or a function";try{r.src(a,function(){t.setStatus(r.text.cberror,"error")})}catch(f){t.setStatus(f.message,"error")}}s.hasClass("ui-corner-all")&&this.search.addClass("ui-corner-all")},showAll:function(){this.el.find(":bio-fragment").show()},filterStatus:function(e,t){var n,r="",i=this.options.text;t>0&&e>0?(n=i.showing_filter,r="info"):t===0&&e===0?(n=i.none_loaded,r="warning"):t>0&&e===0?(n=i.none_matching,r="warning"):t===0&&(n=i.showing_all,r="default"),this.setStatus(n,{filter:e,total:e+t,fragment:e+t===1?i.fragment:i.fragments},r)}})}(jQuery),function(e,t){var n="bio-sequence-loader ui-widget",r="loader-progress",i="loader-warnings ui-widget-content ui-state-error",s="ui-widget-header",o="warning-title",u="ui-icon ui-icon-close",a="ui-widget-content",f=function(){return window.XMLHttpRequest&&"upload"in new XMLHttpRequest},l=function(){return typeof Worker!="undefined"};e.widget("bio.sequenceLoader",{options:{seq_length:null,features:null,post_data:null,auto_start:!1,text:{warnNoXHR2:"Warning: Your browser does not appear to support XMLHttpRequest Level 2. You will not see download progress - please consider updating your browser.",warnNoWebWorkers:"Warning: Your browser does not appear to support webWorkers. The browser may freeze during loading - please consider updating your browser.",warnings:"Warnings"}},_create:function(){this.el=e(this.element[0]).addClass(n),this._build_elements(),this.el.append(this.warnings).append(this.progress),this.warnings.find("li").length>0&&this._show_warnings()},_init:function(){var e=this,t=this.options;this.el.on("error",function(t,n){e._trigger("error",t,n)}).on("progress",function(t,n){e._update(n.loaded,n.total,0)}),t.auto_start&&this.start()},_got_data:function(e){var t=this;this._trigger("downloaded"),this.progress.progressbar("value",50);var n=bio.loadSeqFeature(e);this._update(0,n.length,1),setTimeout(function(){t._process(n)},100)},_process:function(t){var n=this;this.fs=new bio.FeatureStore(t,this.length||this.options.seq_length,!1),e(this.fs).on("progress",function(e,t){n._update(t.done,t.total,1)}).on("completed",function(e,r){n._update(t.length,t.length,1),n._trigger("completed")}),this.fs.go()},start:function(e){var t=this,n=this.options;this.length=e,bio.read_data(function(e){t._got_data(e)},n.features,n.post_data,this.el),this._trigger("start")},featureStore:function(){return this.fs},_build_elements:function(){var t=this,n=this.options.text;this.progress=e("<div>").addClass(r).progressbar({max:100}),this.warnings=e("<div>").addClass(i).append(e("<div>").addClass(s).append(e("<span>").addClass(o).text(n.warnings)).append(e("<span>").addClass(u).click(function(){t._hide_warnings()}))).append(e("<ul>").addClass(a).append(this._get_warnings()))},_hide_warnings:function(){this.warnings.slideUp()},_show_warnings:function(){this.warnings.slideDown()},_get_warnings:function(){var t=this,n=this.options.text,r=e();return f()||(r=r.add(e("<li>"+n.warnNoXHR2+"</li>"))),l()||(r=r.add(e("<li>"+n.warnNoWebWorkers+"</li>"))),r},_update:function(e,t,n){t>0&&this.progress.progressbar("value",50*n+50*(e/t)),this._trigger(n===0?"download":"process",null,{loaded:e,total:t})}})}(jQuery),function(e,t){var n="bio-sequence-overview ui-widget",r=3,i=5,s=3,o=["bp","kb","Mb","Gb","Tb","Pb","Yb"];e.widget("bio.overview",e.ui.mouse,{options:{featureStore:null,colorScheme:{},seq_length:0},setHighlight:function(e,t,n){n=n||!1;var r=this.w/this.options.seq_length,i={x:r*e,width:r*t};this.highlight.show(),n?this.highlight.animate(i,200):this.highlight.attr(i)},_create:function(){var t=this;this.el=e(this.element[0]).addClass(n);var r=this.wrapper=e("<div>").appendTo(this.el);this.paper=new Raphael(r.get(0),r.width(),r.height()),this.scale=this.paper.set(),this._get_size(),this._draw_centerline(),this._get_heights(),this._progressive_draw(),this._create_highlight(),this._mouseInit(),this.el.mousedown(function(e){t._triggerClicked(e)})},_init:function(){},_get_size:function(){this.w=e(this.paper).prop("width"),this.h=e(this.paper).prop("height"),this.w2=this.w/2,this.h2=this.h/2},_triggerClicked:function(e){this._trigger("clicked",null,this._loc_from_ev(e))},_mouseDrag:function(e){this._triggerClicked(e)},_mouseStop:function(e){this._triggerClicked(e)},_get_heights:function(){var e=0,t=0,n=0,r=this.options.featureStore,s;for(e in r.stacks.fwd)t+=r.stacks.fwd[e];for(e in r.stacks.rev)n+=r.stacks.rev[e];this._direction_height=this.h2-i,this._feat_height=Math.min(this._direction_height/t,this._direction_height/n),t=0,n=0,this.stacks={fwd:{},rev:{}};for(e=0;e<r.types.length;e+=1)s=r.types[e],this.stacks.fwd[s]=t,this.stacks.rev[s]=n,t+=r.stacks.fwd[s]*this._feat_height,n+=r.stacks.rev[s]*this._feat_height},_progressive_draw:function(e){var t=this;if(e==null){setTimeout(function(){t._progressive_draw(0)},100);return}var n=this.options.featureStore;if(e>=n.types.length){this._trigger("completed");return}this._draw_features(n.getFeaturesByType(n.types[e])),this._trigger("progress",null,{done:e,total:n.types.length}),setTimeout(function(){t._progressive_draw(e+1)},100)},_draw_features:function(e){var t,n,r,s,o=this.w/this.options.seq_length,u=this.options.featureStore,a=this.options.colorScheme;e=e||u.features;for(n=0;n<e.length;n++)t=e[n],s=t.type.toLowerCase(),r=t.strand()>=0?this.h2-i-this.stacks.fwd[s]-this._feat_height*(.5+t.track):this.h2+i+this.stacks.rev[s]+this._feat_height*(.5+t.track),this.paper.path("M"+o*t.location.start+","+r+"L"+o*t.location.end+","+r).attr({"stroke-width":.8*this._feat_height,stroke:a[s]})},_draw_centerline:function(){this.scale!=null&&this.scale.remove(),this.scale=this.scale||this.paper.set(),this.scale_color=this.el.css("color");var e="M0,"+(this.h2-i)+"L"+this.w+","+(this.h2-i)+"M0,"+(this.h2+i)+"L"+this.w+","+(this.h2+i);this.scale.push(this.paper.path(e).attr({"stroke-width":1,stroke:this.scale_color})),this._set_scale()},_set_scale:function(e){e=e||this.options.seq_length;var t=Math.floor(Math.LOG10E*Math.log(e)/3);t<1&&(t=1),this._scale_bp=Math.pow(10,3*t-1),this._scale_px=this.w*(this._scale_bp/e);var n=[this.h2-r,this.h2+r],s="",u,a=0;for(u=0;u<=this.w/this._scale_px;u+=1){if(u%10===0)continue;a=u*this._scale_px,s+="M"+a+","+n[0]+"L"+a+","+n[1]}this.scale.push(this.paper.path(s).attr({"stroke-width":1,stroke:this.scale_color}));var f=1.6*i,l=this.h2;this.scale.push(this.paper.text(0,l,"0bp").attr({"text-anchor":"start","font-size":f}));var c=o[t];for(u=10;u<=this.w/this._scale_px;u+=10)a=u*this._scale_px,this.scale.push(this.paper.text(a,l,u/10+c).attr({"font-size":f}))},_loc_from_ev:function(e){var t=this.wrapper.offset(),n={},r=this.options.featureStore.types;n.x=e.pageX-t.left,n.y=e.pageY-t.top,n.dir=n.y>this.h2?"rev":"fwd";var s=n.dir==="fwd"?this.h2-i-n.y:n.y-(this.h2+i);n.type=r[r.length-1];for(var o=1;o<r.length;o++)if(s<this.stacks[n.dir][r[o]]){n.type=r[o];break}return n.pos=Math.round(this.options.seq_length*n.x/this.w),n},_create_highlight:function(){this.highlight=this.paper.rect(0,0,this.w,this.h).attr({fill:"#C0F7FE",stroke:"#3DE4FC"}).toBack().hide()}})}(jQuery),function(e,t){var n="bio-sequence ui-widget",r="label",i=12,s=3,o=6,u=10,a=10,f=i+a,l=function(e,t){this.initialize(e,t)},c=l.prototype=new createjs.DisplayObject;c.color="rgb(50,50,50)",c._DOinit=c.initialize,c.initialize=function(e,t){this._DOinit(),this.seq=e,this.color=this.color||t,this.first=0},c._DisplayObject_draw=c.draw,c.draw=function(e,t){var n=this.seq.pos,r=this.seq.h2,o=this.seq.w,a=10,f=a*u,l=a*Math.ceil(n/a),c=(l-n)*u,h=[r-i-s,r-i,r+i,r+i+s],p,d,v=e.strokeStyle;e.strokeStyle=this.color,e.lineWidth=1,e.beginPath(),e.moveTo(0,h[1]),e.lineTo(o,h[1]),e.moveTo(0,h[2]),e.lineTo(o,h[2]),e.stroke();for(p=c;p<o;p+=f)e.beginPath(),e.moveTo(p,h[0]),e.lineTo(p,h[1]),e.moveTo(p,h[2]),e.lineTo(p,h[3]),e.stroke();return e.strokeStyle=v,!0};var h=function(e){this.initialize(e)},p=h.prototype=new createjs.DisplayObject;p.track_height=0,p.type_offsets=null,p.highlight=null,p._DOinit=p.initialize,p.initialize=function(e){this._DOinit(),this.seq=e,this.fs=e.options.featureStore,this.cs=e.options.colorScheme,this.type_offsets={fwd:{},rev:{}};var t,n=0,r=0,i,s=this.fs.getTypes(),o=this.fs.getStackHeight();for(t in s)this.type_offsets.fwd[s[t]]=n,n+=o.fwd[s[t]],this.type_offsets.rev[s[t]]=r,r+=o.rev[s[t]];this.track_height=(this.seq.h2-f)/Math.max(r,n,5)},p.getFeature=function(e,t){e=Math.floor(e);var n=this.seq.h2,r=t<=n?1:-1,i=r>0?this.type_offsets.fwd:this.type_offsets.rev,s=Math.abs(t-n),o,u,a,l;if(s<f)return null;s=(s-f)/this.track_height,l=this.fs.getFeaturesInRange(e,e+1);for(var c in i){if(i[c]>s)break;o=c}u=Math.floor(s-i[o]),l=l[o];for(a in l)if(l[a].strand()===r&&l[a].track===u)return l[a];return null},p.setHighlight=function(e){e!==this.highlight&&(this.highlight=e,this.getStage().update())},p.draw=function(e){var t,n=this.seq.pos,r=this.seq.pos+this.seq.bw,i,s,o,a,l,c;t=this.fs.getFeaturesByTile(this.fs.pos2tile(n),this.fs.pos2tile(r)),e.lineWidth=.8*this.track_height;for(i in t){e.strokeStyle=this.cs[i],s=t[i];for(a in s)o=s[a],e.globalAlpha=o===this.highlight?.8:1,l=o.strand()>=0?this.seq.h2-(f+(this.type_offsets.fwd[i]+.5+o.track)*this.track_height):this.seq.h2+(f+(this.type_offsets.rev[i]+.5+o.track)*this.track_height),e.beginPath(),e.moveTo(u*(o.location.start-n),l),e.lineTo(u*(o.location.end-n),l),e.stroke()}};var d=function(e,t){this.initialize(e,t)},v=d.prototype=new createjs.DisplayObject;v._DOinit=v.initialize,v.initialize=function(e,t){this._DOinit(),this.seq=e,this.sc=t,this.textC="#000000",this.colors={a:"#6258FF",t:"#FFD13D",g:"#57FF3D",c:"#FF3D4B"},this.bases={a:this._draw_base("A"),t:this._draw_base("T"),g:this._draw_base("G"),c:this._draw_base("C")},this.tile=document.createElement("canvas"),this.tile.width=u*Math.ceil(3*this.seq.bw),this.tile.height=2*i,this._update_tile()},v._draw_base=function(e){var t=document.createElement("canvas");t.width=u,t.height=2*i;var n=t.getContext("2d"),r=this.colors,s=2;switch(e.toLowerCase()){case"a":this._draw_arrow(n,s,r.a,r.t),this._draw_base_text(n,"A","T");break;case"t":this._draw_arrow(n,-s,r.t,r.a),this._draw_base_text(n,"T","A");break;case"g":this._draw_arrow(n,s,r.g,r.c),this._draw_base_text(n,"G","C");break;case"c":this._draw_arrow(n,-s,r.c,r.g),this._draw_base_text(n,"C","G")}return t},v._draw_base_text=function(e,t,n){e.fillStyle=this.textC,e.textAlign="center",e.textBaseline="top",e.font="normal "+(i-3)+'px "Helvetica Neue",Helvetica,Arial,sans-serif',e.fillText(t,.5*u,1),e.textBaseline="alphabetic",e.fillText(n,.5*u,2*i-1)},v._draw_arrow=function(e,t,n,r){e.fillStyle=n,e.beginPath(),e.moveTo(0,0),e.lineTo(0,i-t),e.lineTo(.5*u,i+t),e.lineTo(u,i-t),e.lineTo(u,0),e.fill(),e.beginPath(),e.fillStyle=r,e.moveTo(0,2*i),e.lineTo(0,i-t),e.lineTo(.5*u,i+t),e.lineTo(u,i-t),e.lineTo(u,2*i),e.fill()},v._update_tile=function(){var e=this,t=this.tile.getContext("2d"),n=Math.floor(Math.max(0,this.seq.pos-this.seq.bw)),r=Math.ceil(n+3*this.seq.bw),i=this.sc.get(Math.floor(n),Math.ceil(r)+1,function(){e._update_tile(),e.getStage().update()}),s,o,a,f;this.tile_start=n,this.tile_end=r,t.clearRect(0,0,this.tile.width,this.tile.height);for(s=0;s<i.length;s+=1){a=i[s];for(o=0;o<a.seq.length;o+=1)f=a.seq[o],t.drawImage(this.bases[f],(a.from+o-n)*u,0)}},v.draw=function(e){(this.seq.pos<this.tile_start||this.seq.pos+this.seq.bw>this.tile_end)&&this._update_tile(),e.drawImage(this.tile,Math.round(u*(this.seq.pos-this.tile_start)),0,this.seq.w,2*i,0,this.seq.h2-i,this.seq.w,2*i)};var m=function(e){return e.__handleMouseMove=e._handleMouseMove,e._handleMouseMove=function(){},e};e.widget("bio.kineticScroll",e.ui.mouse,{options:{slow:.9,stop:.1,fps:25,scroll:function(e,t){}},_create:function(){var t=this;this.last_pos={x:0,y:0},this.vel={dx:0,dy:0},this._mouseInit(),this.timer=null,e(this.element[0]).bind("mousedown",function(e){t.vel.dx=t.vel.dy=0,t.timer&&(clearTimeout(t.timer),t.timer=null)})},_mouseDrag:function(e){var t=e.pageX-this.last_pos.x,n=e.pageY-this.last_pos.y,r=e.timeStamp-this.last_pos.time;this._scroll(t,n),this.vel.dy=.5*(this.vel.dy+1e3*n/r),this.vel.dx=.5*(this.vel.dx+1e3*t/r),this._update(e)},_step:function(){var e=this.options,t=this,n=1/e.fps;this.vel.dx=e.slow*this.vel.dx,this.vel.dy=e.slow*this.vel.dy;if(this.vel.dx*this.vel.dx+this.vel.dy*this.vel.dy<e.stop*e.stop){this.vel.dx=this.vel.dy=0;return}this._scroll(n*this.vel.dx,n*this.vel.dy),this.timer=setTimeout(function(){t._step()},1e3*n)},_mouseStart:function(e){this._update(e)},_mouseStop:function(e){var t=this;this.timer=setTimeout(function(){t._step()},1e3/this.options.fps)},_scroll:function(e,t){},cancelScroll:function(){this.vel.dx=this.vel.dy=0},_update:function(e){this.last_pos.x=e.pageX,this.last_pos.y=e.pageY,this.last_pos.time=e.timeStamp}}),e.widget("bio.sequence",e.bio.kineticScroll,{options:{tile_length:1024,tick_color:null,featureStore:null,sequence:null,text:{noCanvas:"Sorry, your browser does not support HTML5 canvas.\nPlease upgrade your browser to use this widget"}},_create:function(){this._super(),this.el=e(this.element[0]).addClass(n);var t=this.options;t.tick_color=t.tick_color||this.el.css("color"),t.back_color=t.back_color||this.el.css("background-color"),this._create_canvas(),this._create_labels(),this._trigger("completed"),this.moveTo(0),this._bind_events()},_init:function(){},_destroy:function(){this._mouseDestroy()},moveTo:function(t){this.pos=Math.max(0,Math.min(t,this.options.featureStore.seq_length-this.bw)),this.stage.update();var n=parseInt(this.labels.children(":first-child"),10),r=50*Math.ceil(this.pos/50);if(r!==n){var i=r;this.labels.children().each(function(){e(this).text(i),i+=50})}this.labels.css("left",(r-this.pos-25)*u),this._trigger("moved",null,{start:this.pos,width:this.bw})},center:function(e){this.moveTo(e-this.bw/2),this.cancelScroll()},_bind_events:function(){var e=this;this.el.mousemove(function(t){var n=e._ev_to_pos(t);e.featureObject.setHighlight(n.feature),e.el.css("cursor",n.feature==null?"move":"pointer")})},_ev_to_pos:function(e){var t=this.el.offset(),n={left:e.pageX-t.left,top:e.pageY-t.top,loc:this.pos+(e.pageX-t.left)*this.bw/this.w};return n.feature=this.featureObject.getFeature(n.loc,n.top),n},_calc_sizes:function(){var e=this.options;this.h=this.el.height(),this.h2=this.h/2,this.w=this.el.width(),this.w2=this.w/2,this.bw=Math.floor(this.w/u),this.canvas.width(this.w),this.canvas.height(this.h),this.canvas.attr({width:this.w,height:this.h})},_create_canvas:function(){this.canvas=e("<canvas>").append(e("<div>").append(e("<p>").text(this.options.text.noCanvas))).appendTo(this.el),this.stage=m(new createjs.Stage(this.canvas.get(0))),this.stage.enableMouseOver(0),this.pos=0,this._calc_sizes(),this.stage.addChild(new l(this)),this.featureObject=new h(this),this.stage.addChild(this.featureObject),this.stage.addChild(new d(this,new bio.SequenceCache(this.options.sequence)))},_create_labels:function(){this.labels!=null&&this.labels.remove(),this.labels=e("<div>").addClass(r);var t=Math.ceil(this.w/(50*u)),n=50*u,o;for(o=0;o<t;o+=1)e("<div>").text(50*o).css("width",n+"px").appendTo(this.labels);this.labels.css({top:this.h2+i+s+1}).appendTo(this.el)},_scroll:function(e,t){this.moveTo(this.pos-e/u)}})}(jQuery),function(e,t){var n="bio-sequence-view ui-widget",r="bio-meta",i="bio-name",s="bio-desc",o="bio-overview",u="bio-key",a="bio-keyitem",f="bio-zoomview",l="bio-slideleft",c="bio-slideright",h="load-panel",p=["B","kB","MB","GB","PB"];e.widget("bio.sequenceView",e.bio.panel,{options:{title:t,help:t,post_data:null,metadata:null,features:null,sequence:null,text:{defaultTitle:"Sequence View",defaultHelp:"Drag to scroll around in the fragment",defaultStatus:"No fragment loaded",metaError:"Error fetching metadata: %(message)",featureError:"Error fetching features: %(message)",download_status:"Downloading Features: %(loaded) of %(total)",process_status:"Processing Features: %(loaded) of %(total)",download_start:"Downloading Features...",loading_graphics:"Loading Graphics...",load_complete:"Loading Complete"},height:400},_create:function(){this._super();var t=this,r=this.options,i=this.el=e(this.element[0]).addClass(n);this._build_elements(),this._show_meta(),this._show_loader()},_init:function(){this._super();var e=this,t=this.options;this.el.on("metadata.error",function(n,r){e.setStatus(t.text.metaError,r,"error")}),bio.read_data(function(t){e._update_meta(t),e.loader.sequenceLoader("start",e.meta.length)},t.metadata,t.post_data,this.el,"metadata")},_update_meta:function(e){this.name.text(e.name),this.desc.text(e.description),this.meta=e,this._refresh()},_build_elements:function(){var t=this.metadata=this._panel_item().addClass(r);this.name=e("<p>").addClass(i).text("").appendTo(t),this.desc=e("<p>").addClass(s).text("").appendTo(t),this.seqview=e("<div>"),this.overview=this._panel_item().addClass(o).appendTo(this.seqview),this.key=this._panel_item().addClass(u).appendTo(this.seqview);var n=this.zoomview=this._panel_item().addClass(f).appendTo(this.seqview);this.loader=e("<div>").sequenceLoader({features:this.options.features,post_data:this.options.post_data}),this.loaderpanel=this._panel_item().addClass(h).append(this.loader)},_show_meta:function(){this.panel.append(this.metadata)},_show_loader:function(){var e=this.options.text,t=this;this.panel.append(this.loaderpanel),this.stretch_factors={loaderpanel:1},this._refresh(),this.loader.on("sequenceloadererror",function(n,r){t.setStatus(e.featureError,r,"error")}).on("sequenceloaderdownload",function(n,r){t.setStatus(e.download_status,{loaded:t._readable(r.loaded),total:t._readable(r.total)},"loading")}).on("sequenceloaderprocess",function(n,r){t.setStatus(e.process_status,r,"loading")}).on("sequenceloaderstart",function(n){t.setStatus(e.download_start,"loading")}).on("sequenceloadercompleted",function(n){t.setStatus(e.loading_graphics,"loading"),t._load_graphics(t.loader.sequenceLoader("featureStore"))})},_load_graphics:function(e){this.fs=e,this._hide_loader(),this._show_seqview();var t=this,n=this.options.text,r=0,i=function(){r+=1,r===2&&t.setStatus(n.load_complete)};setTimeout(function(){t.overview.overview({featureStore:e,colorScheme:t._get_color_scheme(e.types),seq_length:t.meta.length,completed:i,clicked:function(e,n){t.zoomview.sequence("center",n.pos)}}),t.zoomview.sequence({featureStore:e,colorScheme:t._get_color_scheme(e.types),tile_length:1024,seq_length:t.meta.length,sequence:t.options.sequence,completed:i,moved:function(e,n){t.overview.overview("setHighlight",n.start,n.width)}}),t._show_key(t._get_color_scheme(e.types))},50)},_hide_loader:function(){this.loaderpanel.remove(),this.loader.off()},_show_seqview:function(){this.stretch_factors={zoomview:5,key:1,overview:2},this.panel.append(this.seqview),this._refresh()},_show_key:function(t){var n,r;for(n in t)r=e("<p>").addClass(a).text(n).prepend(e("<span>").css("background-color",t[n])),this.key.append(r)},_get_color_scheme:function(e){if(this.colorscheme==null){this.colorscheme={};var t=360/e.length;for(var n=0;n<e.length;n++)this.colorscheme[e[n].toLowerCase()]=Raphael.hsl(n*t,50,50)}return this.colorscheme},_readable:function(e){var t=0;for(;t<p.length;t++)if(e/Math.pow(1024,t+1)<1)break;return(parseFloat(e)/Math.pow(1024,t)).toFixed(2)+" "+p[t]}})}(jQuery);