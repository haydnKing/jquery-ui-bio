/*! jQuery Ui Bio - v0.1.0 - 2013-01-03
* https://github.com/Gibthon/jquery-ui-bio
* Copyright (c) 2013 Haydn King; Licensed MIT, GPL */
(function(e,t){var n="bio-help ui-widget",r="tip ui-widget-content ui-corner-inherit",i="ui-corner-all";e.widget("bio.help",{options:{helphtml:"Some Help",open:t,close:t},_init:function(){var t=this,i=this.options,s=this.el=e(this.element[0]).addClass(n),o=e("<div>").addClass(r).appendTo(s);s.hasClass("ui-corner-all")&&o.addClass("ui-corner-all"),e("<p>").html(i.helphtml).appendTo(o),o.tooltip({mouseTarget:s})},_create:function(){}})})(jQuery);var next_color=function(){var e=Math.random()*360,t=360/1.61803;return function(){return e=Math.floor(e+t)%360,"hsl("+e+",40%,50%)"}}();this.bio=this.bio||{},function(){var e=function(e,t,n){this.init(e,t,n)},t=e.prototype;t.init=function(e,t,n){this.start=e||0,this.end=t||0,this.strand=(n||1)>0?1:-1;if(this.end<this.start){var r=this.end;this.end=this.start,this.start=r}},t.overlaps=function(e){Array.isArray(e)||(e=[e]);for(var t=0;t<e.length;t++)if(this.contains(e[t].start)||this.contains(e[t].end)||e[t].contains(this.start))return!0;return!1},t.contains=function(e){return this.start<=e&&this.end>e},t.length=function(){return this.end-this.start},bio.FeatureLocation=e;var n=function(e,t,n,r){this.init(e,t,n,r)},r=n.prototype;r.location=null,r.type="NoneType",r.id=-1,r.qualifiers={},r.strand=function(){return this.location.strand},r.length=function(){return this.location.length()},r.overlaps=function(e){Array.isArray(e)||(e=[e]);for(var t=0;t<e.length;t++)if(this.location.overlaps(e[t].location))return!0;return!1},r.toString=function(){return"[seqFeature (id="+this.id+", type="+this.type+"]"},r.init=function(e,t,n,r){n==null&&(n=-1),this.location=e,this.type=t||"NoneType",this.id=n,this.qualifiers=r||{}},bio.SeqFeature=n,bio.loadFeatureLocation=function(t){Array.isArray(t)||(t=[t]);var n=[];for(var r=0;r<t.length;r++)n.push(new e(t[r].start,t[r].end,t[r].strand));return n},bio.loadSeqFeature=function(e){Array.isArray(e)||(e=[e]);var t=[];for(var r=0;r<e.length;r++)t.push(new n(bio.loadFeatureLocation(e[r].location)[0],e[r].type,e[r].id,e[r].qualifiers));return t};var i=function(e,t,n){this.init(e,t,n)},s=i.prototype;s.features=[],s.tile_size=1024,s.length=0,s.types=[],s.by_type={},s.stacks={},s.tiles=[],s.getTypes=function(){return this.types},s.getFeatures=function(){return this.features},s.getFeaturesByType=function(e){return this.by_type[e.toLowerCase()]},s.pos2tile=function(e){return Math.floor(e/this.tile_size)},s.tile2pos=function(e){return[this.tile_size*e,this.tile_size*(e+1)]},s.init=function(e,t,n){this.features=e||[],n!=null&&(this.tile_size=parseInt(n,10)),this.length=t,this._calc_types(),this._calc_tracks(),this._calc_tiles()},s._calc_types=function(){var e,t,n;this.by_type={},this.types=[];for(e=0;e<this.features.length;e++)t=this.features[e],n=t.type.toLowerCase(),this.by_type.hasOwnProperty(n)||(this.by_type[n]=[],this.types.push(n)),this.by_type[n].push(t)},s._calc_tracks=function(){var e,t,n,r;this.stacks={fwd:{},rev:{}};for(e=0;e<this.types.length;e++){t=this.getFeaturesByType(this.types[e]),n=[],r=[];for(var i=0;i<t.length;i++)t[i].strand()>=0?n.push(t[i]):r.push(t[i]);this.stacks.fwd[this.types[e]]=this._set_tracks(n),this.stacks.rev[this.types[e]]=this._set_tracks(r)}},s._set_tracks=function(e){if(e.length===0)return 0;var t=0,n,r,i=[[]],s;e.sort(function(e,t){return t.length()-e.length()});for(n=0;n<e.length;n++){r=e[n],s=!1;for(t=0;t<i.length;t++)if(!r.overlaps(i[t])){s=!0;break}s?(i[t].push(r),r.track=t):(r.track=i.length,i.push([r]))}return i.length},s._calc_tiles=function(){var e,t,n,r,i,s;this.tiles=[];for(t=0;t<this.length/this.tile_size;t++){r={};for(n=0;n<this.types.length;n++)r[this.types[n]]=[];this.tiles.push(r)}for(t=0;t<this.features.length;t++){e=this.features[t],i=this.pos2tile(e.location.start),s=this.pos2tile(e.location.end-1);for(r=i;r<=s;r++)this.tiles[r][e.type].push(e)}},bio.FeatureStore=i}(),function(e,t){var n="bio-fragment-select ui-widget",r="bio-panel ui-widget-content ui-state-default",i="bio-bottom ui-widget ui-widget-header",s="ui-icon-carat-1-e",o=function(e,t){return t.test(e.fragment("option","name"))||t.test(e.fragment("option","desc"))};e.widget("bio.fragmentSelect",{options:{text:{title:"Fragment Selector",helphtml:"Drag and drop fragments to select them",filter:"filter",loading:"Loading fragments...",none_loaded:"No fragments are loaded",none_matching:"No fragments match the filter",showing_all:"Showing %total %fragment",showing_filter:"Showing %filter of %total %fragment",fragment:"fragment",fragments:"fragments"},defaultHelper:"clone",height:400},_create:function(){var t=this,s=this.options,o=this.el=e(this.element[0]).addClass(n);this.timeout=null;var u=this.header=e("<div>").addClass("ui-widget-header").appendTo(o),a=this.panel=e("<div>").addClass(r).appendTo(o),f=e("<div>").addClass(i).appendTo(o);e("<span>").addClass("title").text(s.text.title).appendTo(u);var l=e("<span>").appendTo(u).help({helphtml:s.text.helphtml}),c=e("<div>").addClass("searchbar").appendTo(a);this.search=e("<div>").search({text:{search:"filter"},change:function(){t.filter(t.search.search("value"))}}).appendTo(c),this.list=e("<div>").addClass("list ui-state-default").appendTo(a);var h=e("<div>").addClass("ui-state-default statusbar").appendTo(a);this.status_icon=e("<span>").addClass("ui-icon").appendTo(h),this.status_text=e("<p>").appendTo(h);var p=o.find("ul");p.length===1?p.detach().appendTo(this.list):p=e("ul").appendTo(this.list),p.find("li").each(function(){e(this).addClass("ui-state-default").children().fragment({helper:s.defaultHelper})}),p.on({mouseenter:function(){e(this).addClass("ui-state-hover")},"mouseleave dragstop":function(){e(this).removeClass("ui-state-hover")}},"ul > li"),this.setStatus(),this._set_height(),o.hasClass("ui-corner-all")&&(u.addClass("ui-corner-top"),this.search.addClass("ui-corner-all"),f.addClass("ui-corner-bottom"),l.addClass("ui-corner-all"))},filter:function(t){var n=new RegExp(t,"i");this.el.find(":bio-fragment").each(function(){var t=e(this);o(t,n)?t.parent().show():t.parent().hide()}),this.setStatus()},showAll:function(){this.el.find(":bio-fragment").show()},setStatus:function(e,t){var n=this.list.find(":bio-fragment").length,r=this.list.find(":bio-fragment:visible").length;if(e==null){var i=this.options.text;n===0&&r===0?(e=i.none_loaded,t="ui-icon-alert"):n>0&&r===0?(e=i.none_matching,t="ui-icon-alert"):n===r?e=i.showing_all:e=i.showing_filter}this.status_icon.attr("class","ui-icon "+(t||s)),this.status_text.text(this._get_text(e,r,n))},_set_height:function(){var t=0;this.panel.siblings().add(this.list.siblings()).each(function(){t+=e(this).outerHeight()}),this.list.outerHeight(this.options.height-t)},_get_text:function(e,t,n){var r=this.options.text;return e.replace("%filter",t).replace("%total",n).replace("%fragment",n===1?r.fragment:r.fragments)}})}(jQuery),function(e,t){e.widget("bio.tooltip",{options:{mouseTarget:"this",openDelay:250,closeDelay:250,openAnim:0,closeAnim:200},_create:function(){var t=this.el=e(this.element[0]).hide(),n=this.options,r=this;typeof n.mouseTarget=="string"&&(n.mouseTarget==="this"?n.mouseTarget=t:n.mouseTarget=t.find(n.mouseTarget)),this.timeout=null,this._is_open=!1,this._enabled=!0,n.mouseTarget.mouseenter(function(){r._on_enter()}).mouseleave(function(){r._on_leave()})},close:function(){this._clear_timeout(),this.el.fadeOut(this.options.closeAnim),this._is_open=!1,this._trigger("close")},open:function(){this._clear_timeout(),this.el.fadeIn(this.options.openAnim),this._is_open=!0,this._trigger("open")},disable:function(){this.close(),this._enabled=!1},enable:function(){this._enabled=!0},_on_enter:function(){if(!this._enabled)return;var e=this,t=this.options;this._clear_timeout(),this._is_open||(this.timeout=setTimeout(function(){e.open()},t.openDelay))},_on_leave:function(){if(!this._enabled)return;var e=this,t=this.options;this._clear_timeout(),this._is_open&&(this.timeout=setTimeout(function(){e.close()},t.closeDelay))},_clear_timeout:function(){this.timeout!=null&&(clearTimeout(this.timeout),this.timeout=null)}})}(jQuery),function(e,t){var n="bio-fragment ui-widget",r="ui-state-hover ui-state-active",i="ui-state-disabled",s="ui-corner-all";e.widget("bio.fragment",e.ui.draggable,{options:{name:null,desc:null,length:null,url:t,color:t,text:{goto_page:"Goto Page",def_desc:"No Description",def_name:"Unnamed Fragment"},helper:"clone"},_create:function(){var t=this.options,r=this,i=this.el=e(this.element[0]).addClass(n);t.name=i.attr("name")||t.name||t.text.def_name,t.desc=i.attr("desc")||t.desc||t.text.def_desc,t.length=i.attr("length")||t.length||0,t.url=i.attr("href")||t.url,t.color=t.color||next_color(),this.name=e("<p>").text(t.name).addClass("bio-name").appendTo(i),this.info=e("<div>").hide().addClass(s).appendTo(i).mousedown(function(e){e.stopPropagation()}),this.refreshInfo(),i.css({"background-color":t.color,"border-color":t.color}),t.helper==="clone"&&(t.helper=function(){return e("<div>").addClass(n).css({"background-color":t.color,"border-color":t.color,"z-index":100}).append(e("<p>").text(t.name))}),i.draggable(t).on("dragstart",function(){r.info.tooltip("disable")}).on("dragstop",function(){r.info.tooltip("enable")}),this.info.tooltip({mouseTarget:this.el,openDelay:500})},_init:function(){},option:function(e,t){var n=this.options;if(t==null)return n[e]||this.$el.draggable(e);n[e]=t;switch(e){case"name":this.name.text(t);break;case"desc":case"length":case"url":this.refreshInfo();break;case"color":this.el.css({"background-color":this.options.color,"border-color":this.options.color});break;case"draggable":this.el.draggable(t?"enable":"disable");break;default:this.el.draggable(e,t)}return this},refreshInfo:function(){var t=this.options;this.info.html(""),e('<div><p class="bio-length">'+t.length+"</p></div>").appendTo(this.info),e('<div><p class="bio-desc">'+t.desc+"</p></div>").appendTo(this.info),t.url!=null&&e("<div><a href="+t.url+' class="bio-url">'+t.text.goto_page+"</a></div>").appendTo(this.info)}})}(jQuery),function(e,t){var n="bio-search ui-widget",r="ui-state-default",i="ui-state-hover",s="ui-state-highlight";e.widget("bio.search",{options:{text:{search:"search"},change:t},_create:function(){var t=this,i=this.options,s=this.el=e(this.element[0]).addClass(n);this.timeout=null,s.addClass(n).addClass(r),this.input=e('<input type="text">').appendTo(e("<div>").appendTo(s)),this.search_hint=e("<div>").addClass("hint").text(i.text.search).appendTo(s),e("<span>").addClass("ui-icon ui-icon-search").appendTo(s),this.search_clear=e("<span>").addClass("ui-icon ui-icon-close").hide().appendTo(s)},_init:function(){var t=this,n=this.options;this.input.on({focus:function(){t.search_hint.hide(),t.el.removeClass(r).removeClass(i).addClass(s)},blur:function(){e(this).val()||(t.search_hint.show(),t.search_clear.hide()),t.el.removeClass(s).addClass(r)},keyup:function(){var e=t.input.val();e?t.search_clear.show():t.search_clear.hide(),t.timeout&&clearTimeout(t.timeout),t.timeout=setTimeout(function(){t.timeout=null,t._trigger("change",e)},500)}}),this.el.on({click:function(){t.input.focus()},mouseenter:function(){t.el.hasClass(r)&&t.el.removeClass(r).addClass(i)},mouseleave:function(){t.el.hasClass(i)&&t.el.removeClass(i).addClass(r)}}),this.search_clear.on("click",function(){t.input.val(""),t.search_clear.hide(),t._trigger("change")})},value:function(e){if(e!=null){this.input.val(e),this._trigger("change");return}return this.input.val()}})}(jQuery);