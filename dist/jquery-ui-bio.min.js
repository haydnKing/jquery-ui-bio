/*! jQuery Ui Bio - v0.1.0 - 2013-01-08
* https://github.com/Gibthon/jquery-ui-bio
* Copyright (c) 2013 Haydn King; Licensed MIT, GPL */
this.bio=this.bio||{},function(){var e=function(e,t,n){this.init(e,t,n)},t=e.prototype;t.init=function(e,t,n){this.start=e||0,this.end=t||0,this.strand=(n||1)>0?1:-1;if(this.end<this.start){var r=this.end;this.end=this.start,this.start=r}},t.overlaps=function(e){Array.isArray(e)||(e=[e]);for(var t=0;t<e.length;t++)if(this.contains(e[t].start)||this.contains(e[t].end)||e[t].contains(this.start))return!0;return!1},t.contains=function(e){return this.start<=e&&this.end>e},t.length=function(){return this.end-this.start},bio.FeatureLocation=e;var n=function(e,t,n,r){this.init(e,t,n,r)},r=n.prototype;r.location=null,r.type="NoneType",r.id=-1,r.qualifiers={},r.strand=function(){return this.location.strand},r.length=function(){return this.location.length()},r.overlaps=function(e){Array.isArray(e)||(e=[e]);for(var t=0;t<e.length;t++)if(this.location.overlaps(e[t].location))return!0;return!1},r.toString=function(){return"[seqFeature (id="+this.id+", type="+this.type+"]"},r.init=function(e,t,n,r){n==null&&(n=-1),this.location=e,this.type=t||"NoneType",this.id=n,this.qualifiers=r||{}},bio.SeqFeature=n,bio.loadFeatureLocation=function(t){Array.isArray(t)||(t=[t]);var n=[];for(var r=0;r<t.length;r++)n.push(new e(t[r].start,t[r].end,t[r].strand));return n},bio.loadSeqFeature=function(e){Array.isArray(e)||(e=[e]);var t=[];for(var r=0;r<e.length;r++)t.push(new n(bio.loadFeatureLocation(e[r].location)[0],e[r].type,e[r].id,e[r].qualifiers));return t};var i=function(e,t,n){this.init(e,t,n)},s=i.prototype;s.features=[],s.tile_size=1024,s.length=0,s.types=[],s.by_type={},s.stacks={},s.tiles=[],s.getTypes=function(){return this.types},s.getFeatures=function(){return this.features},s.getFeaturesByType=function(e){return this.by_type[e.toLowerCase()]},s.getFeaturesByTile=function(e){return this.tiles[e]},s.pos2tile=function(e){return Math.floor(e/this.tile_size)},s.tile2pos=function(e){return[this.tile_size*e,this.tile_size*(e+1)]},s.init=function(e,t,n){this.features=e||[],n!=null&&(this.tile_size=parseInt(n,10)),this.length=t,this._calc_types(),this._calc_tracks(),this._calc_tiles()},s._calc_types=function(){var e,t,n;this.by_type={},this.types=[];for(e=0;e<this.features.length;e++)t=this.features[e],n=t.type.toLowerCase(),this.by_type.hasOwnProperty(n)||(this.by_type[n]=[],this.types.push(n)),this.by_type[n].push(t)},s._calc_tracks=function(){var e,t,n,r;this.stacks={fwd:{},rev:{}};for(e=0;e<this.types.length;e++){t=this.getFeaturesByType(this.types[e]),n=[],r=[];for(var i=0;i<t.length;i++)t[i].strand()>=0?n.push(t[i]):r.push(t[i]);this.stacks.fwd[this.types[e]]=this._set_tracks(n),this.stacks.rev[this.types[e]]=this._set_tracks(r)}},s._set_tracks=function(e){if(e.length===0)return 0;var t=0,n,r,i=[[]],s;e.sort(function(e,t){return t.length()-e.length()});for(n=0;n<e.length;n++){r=e[n],s=!1;for(t=0;t<i.length;t++)if(!r.overlaps(i[t])){s=!0;break}s?(i[t].push(r),r.track=t):(r.track=i.length,i.push([r]))}return i.length},s._calc_tiles=function(){var e,t,n,r,i,s;this.tiles=[];for(t=0;t<this.length/this.tile_size;t++){r={};for(n=0;n<this.types.length;n++)r[this.types[n]]=[];this.tiles.push(r)}for(t=0;t<this.features.length;t++){e=this.features[t],i=this.pos2tile(e.location.start),s=this.pos2tile(e.location.end-1);for(r=i;r<=s;r++)this.tiles[r][e.type].push(e)}},bio.FeatureStore=i}(),function(e,t){var n="tooltip ui-widget ui-widget-content ui-corner-all",r="tooltip-left",i="tooltip-right",s="tooltip-top",o="tooltip-bottom",u="ui-widget-content",a="stringContent",f="tip",l=150,c="black";e.widget("bio.tooltip",{options:{hover:250,click:!1,holdOpen:!0,autoClose:!0,content:null,title:null,extraClasses:null,width:100,color:"default",location:"center",direction:"auto",fadeIn:0,fadeOut:100},_create:function(){var t=this.el=e(this.element[0]),n=this.options,r=this;this._tooltip=null,this._evt=null,this._visible=!1,this._enabled=!0,this._timeout=null,this._hidefn=function(){r.hide()}},_init:function(){this._bind_events()},show:function(){if(!this._enabled||this._trigger("beforeShow")===!1)return;this._visible&&this.hide(),this._create_tip(),this._set_content(),this._set_size(),this._set_location(),this._set_color();var t=this;this._tooltip.fadeTo(this.options.fadeIn,1,function(){t._trigger("show")}),this._visible=!0,e(document).one("click",function(){e(document).on("click",t._hidefn)})},hide:function(){e(document).off("click",this._hidefn);if(!this._visible||this._trigger("beforeHide")===!1)return;var t=this,n=t._tooltip;this._tooltip.fadeOut(this.options.fadeOut,function(){n.remove(),t._trigger("hide")}),this._visible=!1,t._tooltip=null},enable:function(){this._enabled=!0},disable:function(){this._enabled=!1,this.hide()},updateContent:function(e){this._set_content(e,!0)},_bind_events:function(){var e=this;this.el.mousemove(function(t){e._mousemove(t)}).mouseleave(function(t){e._mouseleave(t)}).mouseenter(function(t){e._mouseenter(t)}).click(function(t){e._mouseclick(t)})},_mousemove:function(e){if(!this._enabled)return;this._evt=e;var t=this;!this._visible&&this.options.hover>0&&(this._clear_timeout(),this._set_timeout(this.options.hover,function(){t.show()}))},_mouseleave:function(e){if(!this._enabled)return;this._evt=e;var t=this;this.options.autoClose&&this._set_timeout(l,function(){t.hide()})},_mouseenter:function(e){if(!this._enabled)return;this._evt=e,this._clear_timeout()},_mouseclick:function(e){if(!this._enabled)return;this._evt=e,this.options.click&&this.show()},_clear_timeout:function(){typeof this._timeout=="number"&&(clearTimeout(this._timeout),this._timeout=null)},_set_timeout:function(e,t){this._clear_timeout(),this._timeout=setTimeout(function(){this._timout=null,t()},e)},_create_tip:function(){var t=this;this._tooltip=e("<div>").addClass(n+" "+(this.options.extraClasses||"")).fadeTo(0,0).mouseenter(function(e){t._mouseenter(e)}).mouseleave(function(e){t._mouseleave(e)}).click(function(e){e.stopPropagation()}).append(e("<div>").addClass(u)).appendTo(e("body"))},_set_content:function(t,n){t=t||this.options.content,n=n||!1;var r,i,s=this;e.isFunction(t)&&(t=t(this._evt));if(this.el.attr(f)!=null)t=this._get_title().add(e("<p>").text(this.el.attr(f)).addClass(a));else if(typeof t=="string")t=this._get_title().add(e("<p>").text(t).addClass(a));else if(Array.isArray(t)){r=e();for(i=0;i<t.length;i++)r=r.add(this._make_item(t[i],i));t=this._get_title().add(e("<div>").append(r))}else{if(!(t instanceof e))throw"No content specified";t=this._get_title().add(t)}n?(this._tooltip.height(this._tooltip.height()),this._tooltip.children("div").empty().append(t),this._tooltip.animate({height:this._tooltip.children("div").height()},"fast",function(){s._tooltip.css("height",""),s._set_size(),s._set_location()})):this._tooltip.children("div").empty().append(t)},_get_title:function(){var t=this.options.title;e.isFunction(t)&&(t=t(this._evt));if(t==null||t==="")return e();if(typeof t=="string")return e("<div>").addClass("tooltip-title").append(e("<span>").text(t));throw"Unknown title type"},_set_size:function(){var e=this.options.width,t;if(typeof e=="string"&&/%$/.test(e)){var n=parseFloat(e.match("([0-9.]+)%")[1]);e=this.el.width()*n/100}this._tooltip.width(e)},_set_location:function(){var t=this.options.location,n=this.options.direction,u,a,f,l,c;if(t==="center")u=this.el.offset(),u.left+=this.el.width()/2,u.top+=this.el.height()/2;else{if(t!=="mouse")throw"Invalid location '"+t+"'";u={top:this._evt.pageY,left:this._evt.pageX}}n==="auto"&&(a={width:e(window).width(),height:e(window).height()},f={top:e(document).scrollTop(),left:e(document).scrollLeft()},l={width:this._tooltip.outerWidth(!0),height:this._tooltip.outerHeight(!0)},c={top:u.top-f.top,left:u.left-f.left,bottom:f.top+a.height-u.top,right:f.left+a.width-u.left},c.bottom>=l.height&&c.left>=l.width/2&&c.right>=l.width/2?n="s":c.top>=l.height&&c.left>=l.width/2&&c.right>=l.width/2?n="n":c.right>=l.width&&c.top>=l.height/2&&c.bottom>=l.height/2?n="e":c.left>=l.width&&c.top>=l.height/2&&c.bottom>=l.height/2?n="w":c.right>=c.left?n="e":n="w"),e.isFunction(n)&&(n=n(this._evt));var h=this._tooltip;if(n==="n")h.addClass(s),u.left-=l.width/2,u.top-=l.height;else if(n==="s")h.addClass(o),u.left-=l.width/2;else if(n==="e")h.addClass(i),u.top-=l.height/2;else{if(n!=="w")throw"Unknown direction '"+n+"'";h.addClass(r),u.left-=l.width,u.top-=l.height/2}h.css(u)},_set_color:function(){var t=this.options.color;e.isFunction(t)&&(t=t(this._evt));if(t==="default"){if(this.el.css("border-color").length>0)return;t=c}else t==="parent"&&(t=this.el.css("border-color"));this._tooltip.css("border-color",t)},_make_item:function(t,n){var r=this,i=e("<span>");t.icon!=null&&t.icon!==""?i.addClass("ui-icon "+t.iconClass||""):i.css(t.iconCSS||{}).addClass("ui-corner-all");var s=e("<div>").addClass("tooltip-item ui-widget-content ui-state-default").append(e("<div>").addClass("tooltip-icon").append(i)).append(e("<div>").addClass("tooltip-desc").append(e("<span>").text(t.title)).append(e("<p>").text(t.sub||""))).mouseenter(function(e){s.addClass("ui-state-hover")}).mouseleave(function(e){s.removeClass("ui-state-hover")}).mousedown(function(e){s.addClass("ui-state-active")}).mouseup(function(e){s.removeClass("ui-state-active")}).click(function(e){r._trigger("selected",e,{index:n,tooltip:r.el,item:s})});return s}})}(jQuery),function(e,t){var n="bio-help ui-widget",r="bio-help-tip",i="ui-corner-all";e.widget("bio.help",{options:{helphtml:"Some Help",open:t,close:t,width:null},_init:function(){var t=this,i=this.options,s=this.el=e(this.element[0]).addClass(n),o=e("<div>").addClass(r);s.hasClass("ui-corner-all")&&o.addClass("ui-corner-all"),this.help=e("<p>").html(i.helphtml).appendTo(o),this.el.tooltip({content:o,width:this.options.width||250})},_create:function(){},setHelp:function(e){this.options.helphtml(e),this.help.html(e)}})}(jQuery),function(e,t){var n="bio-statusbar ui-widget-content ui-state-default",r="ui-icon",i=/([^\\])%\(([\w]+)\)/g,s="default";e.widget("bio.statusBar",{options:{message:null,state:null,text:{defaultMessage:"Ready"},defaultState:"default",states:{"default":{icon:"ui-icon-circle-triangle-e",state:""},info:{icon:"ui-icon-info",state:""},warning:{icon:"ui-icon-alert",state:"ui-state-highlight"},error:{icon:"ui-icon-alert",state:"ui-state-error"},loading:{icon:"ui-icon-refresh",state:"ui-state-highlight"},ok:{icon:"ui-icon-circle-check",state:""},add:{icon:"ui-icon-circle-plus",state:"ui-state-highlight"},remove:{icon:"ui-icon-circle-minus",state:"ui-state-highlight"},saved:{icon:"ui-icon-disk",state:"ui-state-highlight"}}},_create:function(){var t=this,i=this.options;this.el=e(this.element[0]).addClass(n),this.icon=e("<span>").addClass(r).appendTo(this.el),this.text=e("<p>").appendTo(this.el),this.set(i.message||i.text.defaultMessage)},set:function(e,t,i){e=e||this.options.text.defaultMessage;if(typeof t=="string"||i==null)i=t,t=null;i=i||this.options.defaultState,t!=null&&(e=this._format(e,t)),i=this.options.states[i];if(typeof i=="undefined")throw"Error: unknown state '"+i+"'";this.text.text(e),this.icon.attr("class",r+" "+i.icon),this.el.attr("class",n+" "+i.state)},_format:function(e,t){return e.replace(i,function(e,n,r){return n+String(t[r])})}})}(jQuery),function(e,t){var n="ui-widget bio-panel",r="ui-widget-header ui-state-default",i="bio-panel-content ui-widget-content",s="bio-panel-item ui-widget-content",o="bio-footer ui-widget-header ui-state-default",u="ui-icon-circle-triangle-e";e.widget("bio.panel",{options:{title:t,help:t,text:{defaultTitle:"Bio Panel",defaultHelp:"",defaultStatus:"Ready"},height:400,showStatus:!0},_create:function(){var t=this,s=this.options,u=this.el=e(this.element[0]).addClass(n);s.title=s.title||s.text.defaultTitle,s.help=s.help||s.text.defaultHelp,s.color=s.color||next_color();var a=this.head=e("<div>").addClass(r).appendTo(u),f=this.panel=e("<div>").addClass(i).appendTo(u),l=this.status=e("<div>").statusBar().appendTo(u),c=this.foot=e("<div>").addClass(o).appendTo(u);this.stretch_factors={panel:1},this.title=e("<span>").addClass("title").text(s.title).appendTo(a);var h=this.help=e("<span>").appendTo(a).help({helphtml:s.help});s.showStatus||l.hide(),u.hasClass("ui-corner-all")&&(a.addClass("ui-corner-top"),c.addClass("ui-corner-bottom"),h.addClass("ui-corner-all"))},_init:function(){this._set_height()},option:function(e,t){if(t==null)return this.options[e];switch(e){case"title":this.head.find("span").text(t);break;case"help":this.help("setHelp",t);break;case"height":this._set_height(t)}this.options[e]=t},setStatus:function(e,t,n){this.status.statusBar("set",e,t,n)},_refresh:function(){this._set_height()},_set_height:function(e){var t=0,n=0;e=e||this.options.height;for(var r in this.stretch_factors)n+=this.stretch_factors[r],t+=this[r].outerHeight();var i=this.el.outerHeight()-t;t=Math.max(0,e-i);for(r in this.stretch_factors)this[r].outerHeight(t*this.stretch_factors[r]/n)},_panel_item:function(t){return(t||e("<div>")).addClass(s)}})}(jQuery);var next_color=function(){var e=Math.random()*360,t=360/1.61803;return function(){return e=Math.floor(e+t)%360,"hsl("+e+",40%,50%)"}}();(function(e,t){var n="bio-search ui-widget",r="ui-state-default",i="ui-state-hover",s="ui-state-focus",o="ui-state-error";e.widget("bio.search",{options:{text:{search:"search"},items:e(),filterFunc:function(e,t){return!0},beforeFilter:t,filter:t,pause:150,anim:0},_create:function(){var t=this,i=this.options,s=this.el=e(this.element[0]).addClass(n);this.timeout=null,s.addClass(n).addClass(r),this.input=e('<input type="text">').appendTo(e("<div>").appendTo(s)),this.search_hint=e("<div>").addClass("hint").text(i.text.search).appendTo(s),e("<span>").addClass("ui-icon ui-icon-search").appendTo(s),this.search_clear=e("<span>").addClass("ui-icon ui-icon-close").hide().appendTo(s)},_init:function(){var t=this,n=this.options;this.input.on({focus:function(){t.search_hint.hide(),t.el.addClass(s)},blur:function(){e(this).val()||(t.search_hint.show(),t.search_clear.hide()),t.el.removeClass(s)},keyup:function(){var e=t.input.val();e?t.search_clear.show():t.search_clear.hide(),t.timeout&&clearTimeout(t.timeout),t.timeout=setTimeout(function(){t.timeout=null,t._filter()},n.pause)}}),this.el.on({click:function(){t.input.focus()},mouseenter:function(){t.el.addClass(i)},mouseleave:function(){t.el.removeClass(i)}}),this.search_clear.on("click",function(){t.input.val(""),t.search_clear.hide(),t._filter()})},value:function(e){if(e!=null){this.input.val(e),this._filter();return}return this.input.val()},_filter:function(){if(this._trigger("beforeFilter")!==!0)return;var t=this.options.filterFunc,n=new RegExp(this.input.val(),"i"),r=this.options.items,i=e(),s=e();if(!e.isFunction(t))throw"search.options.filterFunc is not callable";e.isFunction(r)&&(r=r()),r.each(function(){t(n,e(this))?i=i.add(e(this)):s=s.add(e(this))}),i.filter(":hidden").slideDown(this.options.anim),s.filter(":visible").slideUp(this.options.anim),i.length===0&&s.length>0?this.el.addClass(o):this.el.removeClass(o),this._trigger("filter",null,{search:this.el,hide:s,show:i})}})})(jQuery),function(e,t){var n="bio-fragment ui-widget",r="ui-state-hover ui-state-active",i="ui-state-disabled",s="bio-fragment-info",o=10,u=function(e,t,n){n==null&&(n=!0);var r=t/2,i=e-r,s=n?r:-r,o=n?0:r,u="M"+o+",0 h"+i+" l"+r+","+r+" l"+ -r+","+r+" h"+ -i+" l"+r+","+ -r+" z";return u};e.widget("bio.fragment",{options:{name:null,desc:null,length:null,url:t,color:t,width:t,text:{goto_page:"Goto Page",def_desc:"No Description",def_name:"Unnamed Fragment"},helper:"clone"},_create:function(){var t=this.options,r=this,i=this.el=e(this.element[0]).addClass(n);t.name=i.attr("name")||t.name||t.text.def_name,t.desc=i.attr("desc")||t.desc||t.text.def_desc,t.length=i.attr("length")||t.length||0,t.url=i.attr("href")||t.url,t.color=t.color||next_color(),t.width=t.width||i.width(),i.width(t.width);var o=i.width(),u=i.height();this.paper=Raphael(this.element[0],o,u),this.frag=this.paper.path(""),this.name=this.paper.text(o/2,u/2,this.options.name).attr({fill:"white",font:"inherit"}),this.info=e("<div>").addClass(s).mousedown(function(e){e.stopPropagation()}),this.refreshInfo(),i.css({"border-color":t.color}),t.helper==="clone"&&(t.revert=!0,t.helper=function(){return e("<div>").addClass(n).css("z-index",200).append(i.children("svg").clone())}),this.el.tooltip({color:function(){return t.color},content:this.info,width:"125%"}),this._redraw_frag(),this._set_color()},_init:function(){},option:function(e,t){var n=this.options;if(t==null)return n[e];n[e]=t;switch(e){case"name":this._redraw_frag();break;case"desc":case"length":case"url":this.refreshInfo();break;case"width":this._redraw_frag();break;case"color":this.el.css({"border-color":this.options.color}),this._anim_color()}return this},refreshInfo:function(){var t=this.options;this.info.html(""),e('<div><p class="bio-length">'+t.length+"</p></div>").appendTo(this.info),e('<div><p class="bio-desc">'+t.desc+"</p></div>").appendTo(this.info),t.url!=null&&e("<div><a href="+t.url+' class="bio-url">'+t.text.goto_page+"</a></div>").appendTo(this.info)},disable:function(){this.el.tooltip("disable")},enable:function(){this.el.tooltip("enable")},ghost:function(e){e==null&&(e=!0),e?(this.name.attr("opacity",0),this.frag.attr({fill:null,stroke:"#555555","stroke-dasharray":"-"})):(this.name.attr("opacity",1),this._set_color(),this.frag.attr("stroke-dasharray",""))},_set_color:function(){var e=this.options.color.match(/\d+/g);this.frag.attr({fill:Raphael.hsl(e[0],e[1],e[2]),stroke:Raphael.hsl(e[0],e[1],Math.max(0,e[2]-10))})},_anim_color:function(){var e=this.options.color.match(/\d+/g),t=Raphael.animation({fill:Raphael.hsl(e[0],e[1],e[2]),stroke:Raphael.hsl(e[0],e[1],Math.max(0,e[2]-10))},1e3);this.frag.animate(t.delay(100))},_redraw_frag:function(){var e=this.el.width(),t=this.el.height();this.paper.setSize(e,t),this.frag.attr({path:u(e,t)}),this.name.attr({x:e/2,y:t/2,text:this.options.name});var n=this.options.name.length-1;while(this.name.getBBox().width+t>e)n-=1,this.name.attr({text:this.options.name.substr(0,n)+"..."})}})}(jQuery),function(e,t){var n="bio-fragment-select ui-widget",r="ui-icon-circle-triangle-e",i=function(e,t){return t=t.children(":bio-fragment"),e.test(t.fragment("option","name"))||e.test(t.fragment("option","desc"))};e.widget("bio.fragmentSelect",e.bio.panel,{options:{title:t,help:t,text:{defaultTitle:"Fragment Selector",defaultHelp:"Drag and drop fragments to select them",filter:"filter",loading:"Loading fragments...",loaded:"Loaded %(total) %(fragment)",error:"Error",none_loaded:"No fragments are loaded",none_matching:"No fragments match the filter",showing_all:"Showing %(total) %(fragment)",showing_filter:"Showing %(filter) of %(total) %(fragment)",add_fragment:"Added fragment '%(name)'",remove_fragment:"Removed fragment '%(name)'",fragment:"fragment",fragments:"fragments",cberror:"An error occurred"},defaultHelper:"clone",height:400,src:t,color:null},_create:function(){this._super();var t=this,r=this.options,s=this.el=e(this.element[0]).addClass(n);this.stretch_factors={ul:1},this.timeout=null;var o=t._panel_item().addClass("searchbar").appendTo(this.panel);this.search=e("<div>").search({text:{search:"filter"},filter:function(e,n){t.filterStatus(n.show.length,n.hide.length)},filterFunc:i,items:function(){return t.list.find(":bio-fragment").parent()},anim:200}).appendTo(o),this.list=this._panel_item().addClass("list").appendTo(this.panel);var u=this.ul=s.find("ul");u.length===1?u.detach().appendTo(this.list):u=this.ul=e("<ul>").appendTo(this.list),u.sortable({placeholder:"ui-widget-content bio-fragment-placeholder",connectWith:".bio-panel ul",start:function(e,t){t.item.find(":bio-fragment").fragment("disable")},stop:function(e,t){t.item.find(":bio-fragment").fragment("enable")},receive:function(e,n){var i=n.item.find(":bio-fragment");i.fragment("option","color",r.color),t.setStatus(r.text.add_fragment,{name:i.fragment("option","name")},"add")},remove:function(e,n){var i=n.item.find(":bio-fragment");t.setStatus(r.text.remove_fragment,{name:i.fragment("option","name")},"remove")},helper:function(t,n){return e(n).find(":bio-fragment").clone().appendTo(e("body"))}});var a=function(n){for(var i=0;i<n.length;i++){var s=n[i];e("<li>").append(e("<div>").attr({name:s.name,length:s.length,desc:s.desc,href:s.url})).appendTo(u)}u.find("li").each(function(){var t=e(this).width();e(this).children().fragment({color:r.color,width:t})}),t.setStatus(r.text.loaded,{total:n.length,fragment:n.length===1?r.text.fragment:r.text.fragments},"ok"),u.animate({"margin-top":0},"fast",function(){t.list.css("overflow",""),u.css("margin-top","")})};if(r.src!=null)if(typeof r.src=="string")this.list.css("overflow","hidden"),u.css("margin-top",this.list.height()+"px"),this.setStatus(r.text.loading,"loading"),e.ajax({url:r.src,dataType:"json",success:a,error:function(e,n,r){t.setStatus(String(r),"error")}});else{if(!e.isFunction(r.src))throw"options.src must be a string URL or a function";try{r.src(a,function(){t.setStatus(r.text.cberror,"error")})}catch(f){t.setStatus(f.message,"error")}}s.hasClass("ui-corner-all")&&this.search.addClass("ui-corner-all")},showAll:function(){this.el.find(":bio-fragment").show()},filterStatus:function(e,t){var n,r="",i=this.options.text;t>0&&e>0?(n=i.showing_filter,r="info"):t===0&&e===0?(n=i.none_loaded,r="warning"):t>0&&e===0?(n=i.none_matching,r="warning"):t===0&&(n=i.showing_all,r="default"),this.setStatus(n,{filter:e,total:e+t,fragment:e+t===1?i.fragment:i.fragments},r)}})}(jQuery),function(e,t){var n="bio-sequence-loader ui-widget",r="loader-progress",i="loader-warnings ui-widget-content ui-state-error",s="ui-widget-header",o="warning-title",u="ui-icon ui-icon-close",a="ui-widget-content",f=function(){return window.XMLHttpRequest&&"upload"in new XMLHttpRequest},l=function(){return typeof Worker!="undefined"};e.widget("bio.sequenceLoader",{options:{text:{warnNoXHR2:"Warning: Your browser does not appear to support XMLHttpRequest Level 2. You will not see download progress - please consider updating your browser.",warnNoWebWorkers:"Warning: Your browser does not appear to support webWorkers. The browser may freeze during loading - please consider updating your browser.",states:["Downloading","Processing"],warnings:"Warnings"}},_create:function(){this.el=e(this.element[0]).addClass(n),this._build_elements(),this.el.append(this.warnings).append(this.progress),this.warnings.find("li").length>0&&this._show_warnings()},_init:function(){},_build_elements:function(){var t=this,n=this.options.text;this.progress=e("<div>").addClass(r).progressbar({max:100}),this.warnings=e("<div>").addClass(i).append(e("<div>").addClass(s).append(e("<span>").addClass(o).text(n.warnings)).append(e("<span>").addClass(u).click(function(){t._hide_warnings()}))).append(e("<ul>").addClass(a).append(this._get_warnings()))},_hide_warnings:function(){this.warnings.slideUp()},_show_warnings:function(){this.warnings.slideDown()},_get_warnings:function(){var t=this,n=this.options.text,r=e();return f()||(r=r.add(e("<li>"+n.warnNoXHR2+"</li>"))),l()||(r=r.add(e("<li>"+n.warnNoWebWorkers+"</li>"))),r},_update:function(e,t,n){this.progress.progressbar("value",50*n+50*(e/t)),this._trigger("update",null,{state:this.options.states[n],done:e,total:t})}})}(jQuery),function(e,t){var n="bio-sequence-view ui-widget",r="bio-meta",i="bio-name",s="bio-desc",o="bio-overview",u="bio-spacer",a="bio-zoomview",f="bio-slidearrow ui-widget-header",l="bio-slideleft",c="bio-slideright",h="load-panel";e.widget("bio.sequenceView",e.bio.panel,{options:{title:t,help:t,text:{defaultTitle:"Sequence View",defaultHelp:"Drag to scroll around in the fragment",defaultStatus:"No fragment loaded"},height:400},_create:function(){this._super();var t=this,r=this.options,i=this.el=e(this.element[0]).addClass(n);this._build_elements(),this._show_meta(),this._show_loader()},_init:function(){this._super(),this.setStatus(this.options.text.defaultStatus)},_build_elements:function(){var t=this.metadata=this._panel_item().addClass(r);this.name=e("<p>").addClass(i).text("Fragment Name").appendTo(t),this.desc=e("<p>").addClass(s).text("Fragment Description").appendTo(t),this.seqview=e("<div>"),this.overview=this._panel_item().addClass(o).appendTo(this.seqview),this.spacer=this._panel_item().addClass(u).appendTo(this.seqview);var n=this.zoomview=this._panel_item().addClass(a).appendTo(this.seqview);this.right_arrow=e("<div>").addClass(f+" "+c).append(e("<span>").addClass("ui-icon ui-icon-triangle-1-e")).appendTo(n),this.left_arrow=e("<div>").addClass(f+" "+l).append(e("<span>").addClass("ui-icon ui-icon-triangle-1-w")).appendTo(n),this.right_arrow.add(this.left_arrow).mouseenter(function(){e(this).addClass("ui-state-hover")}).mouseleave(function(){e(this).removeClass("ui-state-hover")}),this.loader=e("<div>").sequenceLoader(),this.loaderpanel=this._panel_item().addClass(h).append(this.loader)},_show_meta:function(){this.panel.append(this.metadata)},_show_loader:function(){this.panel.append(this.loaderpanel),this.stretch_factors={loaderpanel:1},this._refresh()},_hide_loader:function(){this.loaderpanel.remove()},_show_seqview:function(){this.stretch_factors={zoomview:5,spacer:1,overview:2},this.panel.append(this.seqview),this._refresh()}})}(jQuery);