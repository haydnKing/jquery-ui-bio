/*! jQuery Ui Bio - v0.1.0 - 2012-11-04
* https://github.com/Gibthon/jquery-ui-bio
* Copyright (c) 2012 Haydn King; Licensed MIT, GPL */
(function(e){e.fn.awesome=function(){return this.each(function(){e(this).html("awesome")})},e.awesome=function(){return"awesome"},e.expr[":"].awesome=function(e){return e.textContent.indexOf("awesome")>=0}})(jQuery),function(e,t){var n="bio-fragment-select ui-widget",r="bio-panel ui-widget-content ui-state-default",i="bio-bottom ui-widget ui-widget-header",s="ui-icon-circle-triangle-e",o=function(e,t){return t.test(e.fragment("option","name"))||t.test(e.fragment("option","desc"))};e.widget("bio.fragmentSelect",{options:{title:t,help:t,text:{defaultTitle:"Fragment Selector",defaultHelp:"Drag and drop fragments to select them",filter:"filter",loading:"Loading fragments...",error:"Error",none_loaded:"No fragments are loaded",none_matching:"No fragments match the filter",showing_all:"Showing %total %fragment",showing_filter:"Showing %filter of %total %fragment",fragment:"fragment",fragments:"fragments"},defaultHelper:"clone",height:400,src:t,color:null},_create:function(){var t=this,s=this.options,o=this.el=e(this.element[0]).addClass(n);s.title=s.title||s.text.defaultTitle,s.help=s.help||s.text.defaultHelp,s.color=s.color||next_color(),this.timeout=null;var u=this.header=e("<div>").addClass("ui-widget-header").appendTo(o),a=this.panel=e("<div>").addClass(r).appendTo(o),f=e("<div>").addClass(i).appendTo(o);e("<span>").addClass("title").text(s.title).appendTo(u);var l=e("<span>").appendTo(u).help({helphtml:s.help}),c=e("<div>").addClass("searchbar").appendTo(a);this.search=e("<div>").search({text:{search:"filter"},change:function(){t.filter(t.search.search("value"))}}).appendTo(c),this.list=e("<div>").addClass("list ui-state-default").appendTo(a);var h=e("<div>").addClass("ui-state-default statusbar").appendTo(a);this.status_icon=e("<span>").addClass("ui-icon").appendTo(h),this.status_text=e("<p>").appendTo(h);var p=this.ul=o.find("ul");p.length===1?p.detach().appendTo(this.list):p=e("<ul>").appendTo(this.list),p.sortable({placeholder:"ui-widget-content",connectWith:".bio-panel ul",start:function(t,n){e(this).find(":bio-fragment").fragment("disable")},stop:function(t,n){e(this).find(":bio-fragment").fragment("enable")},receive:function(e,n){var r=n.item.find(":bio-fragment");r.fragment("option","color",s.color),t.setStatus('Added fragment "'+r.fragment("option","name")+'"',"ui-icon-circle-plus")},remove:function(e,n){var r=n.item.find(":bio-fragment");t.setStatus('Removed fragment "'+r.fragment("option","name")+'"',"ui-icon-circle-minus")}});var d=function(n){for(var r=0;r<n.length;r++){var i=n[r];e("<li>").append(e("<div>").attr({name:i.name,length:i.length,desc:i.desc,href:i.url})).appendTo(p)}p.find("li").each(function(){var t=e(this).width();e(this).children().fragment({color:s.color,width:t})}),t.setStatus(),p.animate({"margin-top":"0px"},"fast",function(){t.list.css("overflow-y","auto")})};if(s.src!=null)if(typeof s.src=="string")this.list.css("overflow","hidden"),p.css("margin-top",this.list.height()+"px"),this.setStatus(s.text.loading,"ui-icon-loading"),e.ajax({url:s.src,dataType:"json",success:d,error:function(e,n,r){t.setStatus(String(r),"ui-icon-alert")}});else{if(!e.isFunction(s.src))throw"options.src must be a string URL or a function";try{s.src(d,function(e){t.setStatus(String(e),"ui-icon-alert")})}catch(v){t.setStatus(v.message,"ui-icon-alert")}}this._set_height(),o.hasClass("ui-corner-all")&&(u.addClass("ui-corner-top"),this.search.addClass("ui-corner-all"),f.addClass("ui-corner-bottom"),l.addClass("ui-corner-all"))},filter:function(t){var n=new RegExp(t,"i");this.el.find(":bio-fragment").each(function(){var t=e(this);o(t,n)?t.parent().show():t.parent().hide()}),this.setStatus()},showAll:function(){this.el.find(":bio-fragment").show()},setStatus:function(e,t){var n=this.list.find(":bio-fragment").length,r=this.list.find(":bio-fragment:visible").length;if(e==null){var i=this.options.text;n===0&&r===0?(e=i.none_loaded,t="ui-icon-alert"):n>0&&r===0?(e=i.none_matching,t="ui-icon-alert"):n===r?e=i.showing_all:e=i.showing_filter}this.status_icon.attr("class","ui-icon "+(t||s)),this.status_text.text(this._get_text(e,r,n))},_set_height:function(){var t=0;this.panel.siblings().add(this.list.siblings()).each(function(){t+=e(this).outerHeight()});var n=this.options.height-t;this.list.outerHeight(n).find("ul").outerHeight(n-5)},_get_text:function(e,t,n){var r=this.options.text;return e.replace("%filter",t).replace("%total",n).replace("%fragment",n===1?r.fragment:r.fragments)}})}(jQuery),function(e,t){var n="bio-search ui-widget",r="ui-state-default",i="ui-state-hover",s="ui-state-highlight";e.widget("bio.search",{options:{text:{search:"search"},change:t},_create:function(){var t=this,i=this.options,s=this.el=e(this.element[0]).addClass(n);this.timeout=null,s.addClass(n).addClass(r),this.input=e('<input type="text">').appendTo(e("<div>").appendTo(s)),this.search_hint=e("<div>").addClass("hint").text(i.text.search).appendTo(s),e("<span>").addClass("ui-icon ui-icon-search").appendTo(s),this.search_clear=e("<span>").addClass("ui-icon ui-icon-close").hide().appendTo(s)},_init:function(){var t=this,n=this.options;this.input.on({focus:function(){t.search_hint.hide(),t.el.removeClass(r).removeClass(i).addClass(s)},blur:function(){e(this).val()||(t.search_hint.show(),t.search_clear.hide()),t.el.removeClass(s).addClass(r)},keyup:function(){var e=t.input.val();e?t.search_clear.show():t.search_clear.hide(),t.timeout&&clearTimeout(t.timeout),t.timeout=setTimeout(function(){t.timeout=null,t._trigger("change",e)},500)}}),this.el.on({click:function(){t.input.focus()},mouseenter:function(){t.el.hasClass(r)&&t.el.removeClass(r).addClass(i)},mouseleave:function(){t.el.hasClass(i)&&t.el.removeClass(i).addClass(r)}}),this.search_clear.on("click",function(){t.input.val(""),t.search_clear.hide(),t._trigger("change")})},value:function(e){if(e!=null){this.input.val(e),this._trigger("change");return}return this.input.val()}})}(jQuery),function(e,t){var n="bio-help ui-widget",r="tip ui-widget-content ui-corner-inherit",i="ui-corner-all";e.widget("bio.help",{options:{helphtml:"Some Help",open:t,close:t},_init:function(){var t=this,i=this.options,s=this.el=e(this.element[0]).addClass(n),o=e("<div>").addClass(r).appendTo(s);s.hasClass("ui-corner-all")&&o.addClass("ui-corner-all"),e("<p>").html(i.helphtml).appendTo(o),o.tooltip({mouseTarget:s})},_create:function(){}})}(jQuery);var next_color=function(){var e=Math.random()*360,t=360/1.61803;return function(){return e=Math.floor(e+t)%360,"hsl("+e+",40%,50%)"}}();(function(e,t){e.widget("bio.tooltip",{options:{mouseTarget:"this",openDelay:250,closeDelay:250,openAnim:0,closeAnim:200},_create:function(){var t=this.el=e(this.element[0]).hide(),n=this.options,r=this;typeof n.mouseTarget=="string"&&(n.mouseTarget==="this"?n.mouseTarget=t:n.mouseTarget=t.find(n.mouseTarget)),this.timeout=null,this._is_open=!1,this._enabled=!0,n.mouseTarget.mouseenter(function(){r._on_enter()}).mouseleave(function(){r._on_leave()})},close:function(){this._clear_timeout(),this.el.fadeOut(this.options.closeAnim),this._is_open=!1,this._trigger("close")},open:function(){this._clear_timeout(),this.el.fadeIn(this.options.openAnim),this._is_open=!0,this._trigger("open")},disable:function(){this.close(),this._enabled=!1},enable:function(){this._enabled=!0},_on_enter:function(){if(!this._enabled)return;var e=this,t=this.options;this._clear_timeout(),this._is_open||(this.timeout=setTimeout(function(){e.open()},t.openDelay))},_on_leave:function(){if(!this._enabled)return;var e=this,t=this.options;this._clear_timeout(),this._is_open&&(this.timeout=setTimeout(function(){e.close()},t.closeDelay))},_clear_timeout:function(){this.timeout!=null&&(clearTimeout(this.timeout),this.timeout=null)}})})(jQuery),function(e,t){var n="bio-fragment ui-widget",r="ui-state-hover ui-state-active",i="ui-state-disabled",s="ui-corner-all",o=10,u=function(e,t,n){n==null&&(n=!0);var r=t/2,i=e-r,s=n?r:-r,o=n?0:r,u="M"+o+",0 h"+i+" l"+r+","+r+" l"+ -r+","+r+" h"+ -i+" l"+r+","+ -r+" z";return u};e.widget("bio.fragment",{options:{name:null,desc:null,length:null,url:t,color:t,width:t,text:{goto_page:"Goto Page",def_desc:"No Description",def_name:"Unnamed Fragment"},helper:"clone"},_create:function(){var t=this.options,r=this,i=this.el=e(this.element[0]).addClass(n);t.name=i.attr("name")||t.name||t.text.def_name,t.desc=i.attr("desc")||t.desc||t.text.def_desc,t.length=i.attr("length")||t.length||0,t.url=i.attr("href")||t.url,t.color=t.color||next_color(),t.width=t.width||i.width(),i.width(t.width);var o=i.width(),u=i.height();this.paper=Raphael(this.element[0],o,u),this.frag=this.paper.path(""),this.name=this.paper.text(o/2,u/2,this.options.name).attr({fill:"white",font:"inherit"}),this.info=e("<div>").hide().addClass(s).appendTo(i).mousedown(function(e){e.stopPropagation()}),this.refreshInfo(),i.css({"border-color":t.color}),t.helper==="clone"&&(t.revert=!0,t.helper=function(){return e("<div>").addClass(n).css("z-index",200).append(i.children("svg").clone())}),this.info.tooltip({mouseTarget:this.el,openDelay:500}),this._redraw_frag(),this._set_color()},_init:function(){},option:function(e,t){var n=this.options;if(t==null)return n[e];n[e]=t;switch(e){case"name":this._redraw_frag();break;case"desc":case"length":case"url":this.refreshInfo();break;case"width":this._redraw_frag();break;case"color":this.el.css({"border-color":this.options.color}),this._anim_color()}return this},refreshInfo:function(){var t=this.options;this.info.html(""),e('<div><p class="bio-length">'+t.length+"</p></div>").appendTo(this.info),e('<div><p class="bio-desc">'+t.desc+"</p></div>").appendTo(this.info),t.url!=null&&e("<div><a href="+t.url+' class="bio-url">'+t.text.goto_page+"</a></div>").appendTo(this.info)},disable:function(){this.info.tooltip("disable")},enable:function(){this.info.tooltip("enable")},ghost:function(e){e==null&&(e=!0),e?(this.name.attr("opacity",0),this.frag.attr({fill:null,stroke:"#555555","stroke-dasharray":"-"})):(this.name.attr("opacity",1),this._set_color(),this.frag.attr("stroke-dasharray",""))},_set_color:function(){var e=this.options.color.match(/\d+/g);this.frag.attr({fill:Raphael.hsl(e[0],e[1],e[2]),stroke:Raphael.hsl(e[0],e[1],Math.max(0,e[2]-10))})},_anim_color:function(){var e=this.options.color.match(/\d+/g),t=Raphael.animation({fill:Raphael.hsl(e[0],e[1],e[2]),stroke:Raphael.hsl(e[0],e[1],Math.max(0,e[2]-10))},1e3);this.frag.animate(t.delay(100))},_redraw_frag:function(){var e=this.el.width(),t=this.el.height();this.paper.setSize(e,t),this.frag.attr({path:u(e,t)}),this.name.attr({x:e/2,y:t/2,text:this.options.name});var n=this.options.name.length-1;while(this.name.getBBox().width+t>e)n-=1,this.name.attr({text:this.options.name.substr(0,n)+"..."})}})}(jQuery);